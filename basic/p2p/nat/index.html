<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NAT 类型探测和 NAT 穿越 | Fancy WebRTC</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3314748_9xij1pv3h4i.css">
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/img/manifest.json">
    <link rel="apple-touch-icon" href="/img/android-chrome-192x192.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="WebRTC notes and learning map all you want.">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="webRTC学习,webRTC教程,webRTC入门">
    <meta name="theme-color" content="#008ACB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa1913f3.css" as="style"><link rel="preload" href="/assets/js/app.2b835d01.js" as="script"><link rel="preload" href="/assets/js/11.8f8d8c94.js" as="script"><link rel="preload" href="/assets/js/46.26125c7a.js" as="script"><link rel="preload" href="/assets/js/16.2ef6dce7.js" as="script"><link rel="preload" href="/assets/js/21.8f4f04c1.js" as="script"><link rel="preload" href="/assets/js/19.7a274e56.js" as="script"><link rel="preload" href="/assets/js/20.cc7484e4.js" as="script"><link rel="preload" href="/assets/js/15.daa60dcc.js" as="script"><link rel="preload" href="/assets/js/13.f9165900.js" as="script"><link rel="prefetch" href="/assets/js/1.2068c1db.js"><link rel="prefetch" href="/assets/js/12.a86359d8.js"><link rel="prefetch" href="/assets/js/14.5bcc0334.js"><link rel="prefetch" href="/assets/js/17.8c318acc.js"><link rel="prefetch" href="/assets/js/18.7f4f6ced.js"><link rel="prefetch" href="/assets/js/22.8e03dbef.js"><link rel="prefetch" href="/assets/js/23.ae5d7b1a.js"><link rel="prefetch" href="/assets/js/24.a07e377d.js"><link rel="prefetch" href="/assets/js/25.ae45a243.js"><link rel="prefetch" href="/assets/js/26.292813ba.js"><link rel="prefetch" href="/assets/js/27.b5422518.js"><link rel="prefetch" href="/assets/js/28.5b569d05.js"><link rel="prefetch" href="/assets/js/29.e406c2e9.js"><link rel="prefetch" href="/assets/js/30.0eba634f.js"><link rel="prefetch" href="/assets/js/31.4f67e3d8.js"><link rel="prefetch" href="/assets/js/32.9e0293ef.js"><link rel="prefetch" href="/assets/js/33.7c756595.js"><link rel="prefetch" href="/assets/js/34.335b4f17.js"><link rel="prefetch" href="/assets/js/35.01786aab.js"><link rel="prefetch" href="/assets/js/36.f2070bed.js"><link rel="prefetch" href="/assets/js/37.7c70043c.js"><link rel="prefetch" href="/assets/js/38.303adcdf.js"><link rel="prefetch" href="/assets/js/39.39b0a121.js"><link rel="prefetch" href="/assets/js/40.27cf0425.js"><link rel="prefetch" href="/assets/js/41.60cc5ac0.js"><link rel="prefetch" href="/assets/js/42.48c15345.js"><link rel="prefetch" href="/assets/js/43.836eadb6.js"><link rel="prefetch" href="/assets/js/44.f83a74c1.js"><link rel="prefetch" href="/assets/js/45.1325bd73.js"><link rel="prefetch" href="/assets/js/47.d8603164.js"><link rel="prefetch" href="/assets/js/48.6a5f1eab.js"><link rel="prefetch" href="/assets/js/49.2d88e192.js"><link rel="prefetch" href="/assets/js/50.e1d6d683.js"><link rel="prefetch" href="/assets/js/51.5204c164.js"><link rel="prefetch" href="/assets/js/52.890170b0.js"><link rel="prefetch" href="/assets/js/53.7d5218da.js"><link rel="prefetch" href="/assets/js/54.081d6d8a.js"><link rel="prefetch" href="/assets/js/55.9193e648.js"><link rel="prefetch" href="/assets/js/56.c283c363.js"><link rel="prefetch" href="/assets/js/57.36ca963e.js"><link rel="prefetch" href="/assets/js/58.ca50e853.js"><link rel="prefetch" href="/assets/js/59.1dfc405f.js"><link rel="prefetch" href="/assets/js/60.a6aafe70.js"><link rel="prefetch" href="/assets/js/61.35b09da6.js"><link rel="prefetch" href="/assets/js/62.d9905bc4.js"><link rel="prefetch" href="/assets/js/63.f502a4a5.js"><link rel="prefetch" href="/assets/js/64.63cb0948.js"><link rel="prefetch" href="/assets/js/65.15922937.js"><link rel="prefetch" href="/assets/js/66.0f2a61bf.js"><link rel="prefetch" href="/assets/js/67.b9bb6554.js"><link rel="prefetch" href="/assets/js/68.c993ab07.js"><link rel="prefetch" href="/assets/js/69.16e4d5cd.js"><link rel="prefetch" href="/assets/js/70.453a604a.js"><link rel="prefetch" href="/assets/js/71.57070527.js"><link rel="prefetch" href="/assets/js/72.7edf97b7.js"><link rel="prefetch" href="/assets/js/73.cb826c97.js"><link rel="prefetch" href="/assets/js/74.f40761ed.js"><link rel="prefetch" href="/assets/js/75.a8fde850.js"><link rel="prefetch" href="/assets/js/76.71255e54.js"><link rel="prefetch" href="/assets/js/77.de20ce37.js"><link rel="prefetch" href="/assets/js/78.91afa182.js"><link rel="prefetch" href="/assets/js/79.5ec162b8.js"><link rel="prefetch" href="/assets/js/80.81ba4a79.js"><link rel="prefetch" href="/assets/js/81.dd9dad97.js"><link rel="prefetch" href="/assets/js/82.5d12f510.js"><link rel="prefetch" href="/assets/js/83.14bee419.js"><link rel="prefetch" href="/assets/js/84.f01335e5.js"><link rel="prefetch" href="/assets/js/vendors~aplayer.ef69e8c8.js"><link rel="prefetch" href="/assets/js/vendors~artplayer.9f457d6b.js"><link rel="prefetch" href="/assets/js/vendors~dash.c779a1b8.js"><link rel="prefetch" href="/assets/js/vendors~dplayer.008e957a.js"><link rel="prefetch" href="/assets/js/vendors~hls.18d1f653.js"><link rel="prefetch" href="/assets/js/vendors~mpegts.02ab45df.js"><link rel="prefetch" href="/assets/js/vendors~shaka-player.f723bd71.js"><link rel="prefetch" href="/assets/js/vendors~webtorrent.271bb3b6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa1913f3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Fancy WebRTC" class="logo"> <span class="site-name can-hide">Fancy WebRTC</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/advance/" class="nav-link">进阶</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="话题" class="dropdown-title"><a href="/topic/" class="link-title">话题</a> <span class="title" style="display:none;">话题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonsam-ng/fancy-webrtc-demos" target="_blank" rel="noopener noreferrer" class="nav-link external">
  实例
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/source/index/" class="nav-link">源码</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ox.jonsam.site/tags/?tag=WebRTC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  书籍资料
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">幻灯片</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-webrtc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/oxygen-space/image.5a0lthv367k0.png"> <div class="blogger-info"><h3>Jonsam NG</h3> <span>让有意义的事变得有意思，让有意思的事变得有意义</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/advance/" class="nav-link">进阶</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="话题" class="dropdown-title"><a href="/topic/" class="link-title">话题</a> <span class="title" style="display:none;">话题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonsam-ng/fancy-webrtc-demos" target="_blank" rel="noopener noreferrer" class="nav-link external">
  实例
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/source/index/" class="nav-link">源码</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ox.jonsam.site/tags/?tag=WebRTC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  书籍资料
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">幻灯片</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-webrtc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/basic/index/" class="sidebar-link">开始上手</a></li><li><a href="/basic/plan/" class="sidebar-link">Plan 计划</a></li><li><a href="/basic/roadmap/" class="sidebar-link">Roadmap 路线</a></li><li><a href="/basic/webrtc-1.0/" class="sidebar-link">WebRTC1.0浏览器间实时通讯</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MDN: WebRTC API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>概要</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>应用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>P2P</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/p2p/index/" class="sidebar-link">本章导读</a></li><li><a href="/basic/p2p/nat-basic/" class="sidebar-link">NAT基础概念详解</a></li><li><a href="/basic/p2p/nat/" aria-current="page" class="active sidebar-link">NAT 类型探测和 NAT 穿越</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#nat-网络地址转换" class="sidebar-link">NAT：网络地址转换</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#nat类型" class="sidebar-link">NAT类型</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#不同nat的穿透性" class="sidebar-link">不同NAT的穿透性</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#nat类型判断" class="sidebar-link">NAT类型判断</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#p2p概念" class="sidebar-link">P2P概念</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#反向链接技术" class="sidebar-link">反向链接技术</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#基于udp协议的p2p打洞技术" class="sidebar-link">基于UDP协议的P2P打洞技术</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#基于tcp协议的p2p打洞技术" class="sidebar-link">基于TCP协议的P2P打洞技术</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#本文小结" class="sidebar-link">本文小结</a></li><li class="sidebar-sub-header level2"><a href="/basic/p2p/nat/#说明" class="sidebar-link">说明</a></li></ul></li><li><a href="/basic/p2p/nat-advance/" class="sidebar-link">NAT穿越方案进阶</a></li><li><a href="/basic/p2p/stun-turn-ice/" class="sidebar-link">STUN、TURN、ICE详解</a></li><li><a href="/basic/p2p/stun/" class="sidebar-link">STUN 详解</a></li><li><a href="/basic/p2p/ice/" class="sidebar-link">ICE 详解</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>协议</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-3f4da221><div class="articleInfo" data-v-3f4da221><ul class="breadcrumbs" data-v-3f4da221><li data-v-3f4da221><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-3f4da221></a></li> <li data-v-3f4da221><a href="/categories/?category=%E5%9F%BA%E7%A1%80" title="分类" data-v-3f4da221>基础</a></li><li data-v-3f4da221><a href="/categories/?category=P2P" title="分类" data-v-3f4da221>P2P</a></li></ul> <div class="info" data-v-3f4da221><div title="作者" class="author iconfont icon-touxiang" data-v-3f4da221><a href="https://github.com/jonsam-ng" target="_blank" title="作者" class="beLink" data-v-3f4da221>jonsam</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-3f4da221><a href="javascript:;" data-v-3f4da221>2022-07-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">NAT 类型探测和 NAT 穿越<!----></h1>  <div class="theme-vdoing-content content__default"><div class="badge-group" data-v-ac1337e0><span class="group-tag" data-v-ac1337e0>标签：</span> <span class="badge tip" style="vertical-align:top;" data-v-ac1337e0 data-v-6223a86a>重要</span></div> <!----> <h2 id="nat-网络地址转换"><a href="#nat-网络地址转换" class="header-anchor">#</a> NAT：网络地址转换</h2> <p>网络地址转换（英语：Network Address Translation，缩写：NAT；又称网络掩蔽、IP掩蔽）在计算机网络中是一种在IP数据包通过路由器或防火墙时重写来源IP地址或目的IP地址的技术。这种技术被普遍使用在有多台主机但只通过一个公有IP地址访问互联网的私有网络中。它是一个方便且得到了广泛应用的技术。当然，NAT也让主机之间的通信变得复杂，导致了通信效率的降低。</p> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.6ffjq8wdrd00.webp" loading="lazy" class="lazy"></p> <p>或者：</p> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.131l8lv3ogw0.webp" loading="lazy" class="lazy"></p> <p>NAT缓解了IPV4地址不够用的问题，同时也带来了限制，那就是NAT外部的主机<strong>无法主动</strong>跟位于NAT内部的主机通信，<strong>NAT内部主机想要通信，必须主动和公网的一个IP通信，路由器负责建立一个映射关系，从而实现数据的转发</strong>， 这就是NAT的工作原理。</p> <h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h3> <ul><li>在一个具有NAT功能的路由器下的主机并没有创建真正的IP地址，并且不能参与一些因特网协议。</li> <li>端对端连接是被IAB委员会（Internet Architecture Board）支持的核心因特网协议之一，因此有些人据此认为NAT是对公用因特网的一个破坏。</li></ul> <h3 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h3> <p>NAT除了带来方便和代价之外，对全双工连接支持的缺少在一些情况下可以看作是一个有好处的特征而不是一个限制。在一定程度上，NAT依赖于本地网络上的一台机器来初始化和路由器另一边的主机的任何连接，它可以阻止外部网络上的主机的恶意活动。这样就可以阻止网络蠕虫病毒来提高本地系统的可靠性，阻挡恶意浏览来提高本地系统的私密性。很多具有NAT功能的防火墙都是使用这种功能来提供核心保护的。另外，它也为UDP的跨局域网的传输提供了方便。</p> <p>参考：</p> <ul><li><a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2" target="_blank" rel="noopener noreferrer">网络地址转换 - 维基百科，自由的百科全书<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="nat类型"><a href="#nat类型" class="header-anchor">#</a> NAT类型</h2> <p>基于UDP的P2P应用需要考虑NAT的类型，因为不同的NAT组合的穿透的方式并不一致，有的能通， 有的不能通。一般来讲， NAT可以分为四种类型，分别是:</p> <ul><li><strong>全锥型</strong>(Full Cone)。</li> <li><strong>受限锥型</strong>(Restricted Cone)， 或者说是IP受限锥型。</li> <li><strong>端口受限锥型</strong>(Port Restricted Cone), 或者说是IP + PORT受限锥型。</li> <li><strong>对称型</strong>(Symmetric)。</li></ul> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.c3wzqfa4et4.webp" loading="lazy" class="lazy"></p> <ul><li>完全圆锥型NAT：这是一种比较宽松的策略，只要建立了内部网络的IP地址和端口与公网IP地址和端口的映射关系，则所有Internet上的主机都可以访问该NAT之后的主机！</li> <li>受限圆锥型NAT：当且仅当内网主机之前己经向公网主机发送过数据分组，此公网主机才能够向内网主机发送数据分组。</li> <li>端口受限圆锥型NAT：端口受限圆锥型NAT增加了端口号的限制，当且仅当内网主机之前已经向公网主机发送了数据分组，公网主机才能和此内网主机通信。</li> <li>对称型NAT：如果同一个内网主机，用相同的内网地址和端口向另一个地址发送数据分组，则会使用不同的映射，而且公网主机只有在接收到数据分组后，才能向与发送分组的内网主机进行通信。可见，对称性NAT是所有NAT类型中限制最为严格的。</li></ul> <p>其中1,2,3属于同一种类型，都是锥型，区别只是路由器的不同的安全策略。还有些NAT不属于这四种中的任何一种，就不在本文的讨论范围了。</p> <h2 id="不同nat的穿透性"><a href="#不同nat的穿透性" class="header-anchor">#</a> 不同NAT的穿透性</h2> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.7bsula6phhw.webp" loading="lazy" class="lazy"></p> <p>对称NAT无法穿透，这个说法不正确。对称NAT与全椎NAT、对称NAT 与 ip受限椎型NAT，是可以穿透的，对称NAT与 端口受限、对称NAT与对称NAT，不可穿透。</p> <h2 id="nat类型判断"><a href="#nat类型判断" class="header-anchor">#</a> NAT类型判断</h2> <p>NAT类型的检测：查看主机所在的NAT网关（提供真正的外网IP地址，而不是伪外网IP地址）是属于哪种NAT类型，是否可以打洞成功。</p> <p>下面就看一下这个整体的判断逻辑，当然在这之前要有一个限定条件，就是在云端一定要部署一个STUN服务。这个STUN服务要有两个IP地址和端口，这两个IP地址的作用稍后会在逻辑判断的过程中介绍。</p> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.4ja4c34xj1u0.webp" loading="lazy" class="lazy"></p> <p>流程：</p> <ol><li>首先客户端要发送一个ECHO请求给服务端（提供STUN服务），服务端收到请求之后，通过同样的IP地址和端口，给我们返回一个信息回来。</li> <li>那在客户端就要等这个消息回复，设置一个超时器，看每个消息是否可以按时回来，那如果我们发送的数据没有回来，则说明这个UDP是不通的，我们就不要再进行判断了（网络不通，不需要判断）。</li> <li>如果我们收到了服务端的响应，那么就能拿到我们这个客户端出口的公网的IP地址和端口，这个时候要判断一下公网的IP地址和本机的IP地址是否是一致的，如果是一致的，说明本机没有在NAT之后而是一个公网地址。</li> <li>接下来要做进一步判断，判断我们的公网地址是不是一个完全的公网地址，这时我们再发送一个信息到第一个IP地址和端口，那服务端收到这个请求之后使用第二个IP地址和端口给我们回消息，如果我们真是一个完全的公网IP地址和端口的话，那其他任何公网上的主机都可以向我发送请求和回数据，这时候我都是能收到的，那如果我能收到，那就说明就是一个公网的地址，所以我们就没有在NAT之后，就完全可以接收数据了。</li> <li>那如果我们收不到，那说明我是在一个防火墙之后，而且一个对称的防火墙。（可以认为与对称NAT一样）</li> <li>如果我收到的公网的IP与我本地的IP不一致，那就说明我们确实是在NAT之后，那既然是在NAT之后我们就要对各种类型作判断了。</li> <li>这时我们再发送一个请求到服务端的第一个IP地址和端口，而服务端通过第二个IP地址和端口给我们回消息，那这时候我们要判断NAT的类型是不是完全锥型，如果我们出去一个请求，在我们的NAT服务和网关上建立了一个内网地址和外网地址的映射表之后，那其他公网上的主机都可以向我这个公网IP地址（含端口）发送消息，并且我可以接收到，那么这个时候可以收到的话，我们就是一个完全锥型NAT。</li> <li>那么如果收不到的话，需要做进一步的判断，这时候需要（客户端主动发送数据，用来探测对称型）向服务端的第二个IP地址和端口发送数据，那么此时服务端会用同样的IP地址和端口给我们回数据，那么这时候它也会带回一个公网的IP地址来，但是如果我们的出口，就是向第二个IP地址发送了请求带回的外网IP与端口与我们第一发送的请求带回的IP地址和端口（主要是端口）如果是不一样的，那就说明是对称型NAT（对称型NAT每次出去都会在映射表上形成不同的外网IP地址和端口）。</li> <li>如果一样（没有修改映射表，没有新建一个映射关系，即是说明客户端的外网IP和端口不变）就说明是限制型的，限制型分为两种一种是IP限制型，一种是端口限制型，所以还需要做进一步的检测。这个时候客户端主动再向服务端第一个IP地址和端口发送一个请求，如果服务端回信息时使用的是之前回复消息所使用的同一个IP地址，但是不是同一个的端口号，那么这时候我们就可以判断是否可以接收到，如果不能接收到，说明是对端口做了限制，所以是端口限制型的NAT，如果可以收到就说明是一个IP地址限制型的NAT。</li> <li>经过这样一个逻辑判断之后 ，我就可以知道我们自己这台在内网的主机是什么NAT类型了。</li></ol> <h3 id="过程简化"><a href="#过程简化" class="header-anchor">#</a> 过程简化</h3> <ol><li>公网还是 NAT：发 1 回 1，内外地址不同是 NAT。</li></ol> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.46x29tsnpw60.webp" loading="lazy" class="lazy"></p> <ol start="2"><li>是否是对称型NAT：发 1 回 1，发 2 回 2，外部地址不同是对称型。</li></ol> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.3r0e9unahhi0.webp" loading="lazy" class="lazy"></p> <ol><li>是否是完全锥型NAT：发 1 回 2，收到回应是完全锥型。</li></ol> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.3y9px2bw3na0.webp" loading="lazy" class="lazy"></p> <ol start="4"><li>IP限制锥型还是端口限制锥型：发 1 换端口回 1，收到回应是IP限制锥型。</li></ol> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.4ibr8f9rolu0.webp" loading="lazy" class="lazy"></p> <h2 id="p2p概念"><a href="#p2p概念" class="header-anchor">#</a> P2P概念</h2> <p>P2P即点对点通信，或称为对等联网，与传统的服务器客户端模式（如下图所示）有着明显的区别，在即时通讯方案中应用广泛（比如IM应用中的实时音视频通信、实时文件传输甚至文字聊天等）。</p> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.4z226tbxenk0.webp" loading="lazy" class="lazy"></p> <p>P2P可以是一种通信模式、一种逻辑网络模型、一种技术、甚至一种理念。在P2P网络中，所有通信节点的地位都是对等的，每个节点都扮演着客户机和服务器双重角色，节点之间通过直接通信实现文件信息、处理器运算能力、存储空间等资源的共享。</p> <p>P2P网络具有<strong>分散性、可扩展性、健壮性</strong>等特点，这使得P2P技术在信息共享、即时通讯、协同工作、分布式计算、网络存储等领域都有广阔的应用。</p> <p>NAT技术和P2P技术作为经典的两项网络技术，在现在的网络上有着广泛的应用，P2P主机位于NAT网关后面的情况屡见不鲜。NAT技术虽然在一定程度上解决了IPv4地址短缺的问题，在构建防火墙、保证网络安全方面都发挥了一定的作用，却破坏了端到端的网络通信。NAT阻碍主机进行P2P通信的主要原因是<strong>NAT不允许外网主机主动访问内网主机</strong>，但是<strong>P2P技术却要求通信双方都能主动发起访问</strong>，所以要在NAT网络环境中进行有效的P2P通信，就必须采用新的解决方案。</p> <p>P2P作为一项实用的技术，有很大的优化空间，并且相对于网络设备，基于P2P的应用程序在实现上更为灵活。所以为了兼容NAT，基于P2P的应用程序在开发的时候大多会根据自身特点加入一些穿越NAT的功能以解决上述问题。以下着重介绍几种常见的P2P穿越NAT方案。</p> <h2 id="反向链接技术"><a href="#反向链接技术" class="header-anchor">#</a> 反向链接技术</h2> <p>此种情况是所有P2P场景中最简单的，通信双方中只有一方位于NAT设备之后，它使用一种被称为“反向链接技术”来解决这个问题。大致的原理如下所述。</p> <p>如图3所示，客户端A位于NAT之后，它通过TCP端口1234连接到服务器的TCP端口1235上，NAT设备为这个连接重新分配了TCP端口62000。客户端B也通过TCP端口1234连接到服务器端口1235上。</p> <p>A和B从服务器处获知的对方的外网地址二元组{IP地址:端口号}分别为{138.76.29.7:1234}和{155.99.25.11:62000}，它们在各自的本地端口上进行侦听。</p> <p>由于B 拥有外网IP地址，所以A要主动发起与B的通信，可以直接通过TCP连接到B。</p> <p>但如果B尝试通过TCP主动连接到A进行P2P通信，则会失败，原因是A位于NAT设备后，虽然B发出的TCP SYN请求能够到达NAT设备的端口62000，但NAT设备会拒绝这个连接请求。</p> <p>要想与Client A通信， B不是直接向A发起连接，而是通过服务器给A转发一个连接请求，反过来请求A连接到B（即进行反向链接），A在收到从服务器转发过来的请求以后，会主动向B发起一个TCP的连接请求，这样在NAT设备上就会建立起关于这个连接的相关表项，使A和B之间能够正常通信，从而建立起它们之间的TCP连接。</p> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220704/image.6qznncvzg6g0.webp" loading="lazy" class="lazy"></p> <h2 id="基于udp协议的p2p打洞技术"><a href="#基于udp协议的p2p打洞技术" class="header-anchor">#</a> 基于UDP协议的P2P打洞技术</h2> <h3 id="原理概述"><a href="#原理概述" class="header-anchor">#</a> 原理概述</h3> <p>UDP打洞技术是通过中间服务器的协助在各自的NAT网关上建立相关的表项，使P2P连接的双方发送的报文能够直接穿透对方的NAT网关，从而实现P2P客户端互连。如果两台位于NAT设备后面的P2P客户端希望在自己的NAT网关上打个洞，那么他们需要一个协助者——<strong>集中服务器</strong>，并且还需要一种<strong>用于打洞的Session建立机制</strong>。</p> <h4 id="什么是集中服务器"><a href="#什么是集中服务器" class="header-anchor">#</a> 什么是集中服务器？</h4> <p>集中服务器本质上是一台被设置在公网上的服务器，建立P2P的双方都可以直接访问到这台服务器。位于NAT网关后面的客户端A和B都可以与一台已知的集中服务器建立连接，并通过这台集中服务器了解对方的信息并中转各自的信息。</p> <p>同时集中服务器的另一个重要作用在于判断某个客户端是否在NAT网关之后。具体的方法是：</p> <p>一个客户端在集中服务器上登陆的时候，服务器记录下该客户端的两对地址<strong>二元组信息</strong>{IP地址:UDP端口}，一对是该客户端与集中服务器进行通信的自身的IP地址和端口号，另一对是集中服务器记录下的由服务器“观察”到的该客户端实际与自己通信所使用的IP地址和端口号（NAT网关的信息）。我们可以把前一对地址二元组看作是客户端的内网IP地址和端口号，把后一对地址二元组看作是客户端的内网IP地址和端口号经过NAT转换后的外网IP地址和端口号。</p> <p>集中服务器可以从客户端的登陆消息中得到该客户端的内网相关信息，还可以通过登陆消息的IP头和UDP头得到该客户端的外网相关信息。</p> <p>如果该客户端不是位于NAT设备后面，那么采用上述方法得到的两对地址二元组信息是完全相同的。</p> <h4 id="p2p的session建立原理"><a href="#p2p的session建立原理" class="header-anchor">#</a> P2P的Session建立原理</h4> <p>假定客户端A要发起对客户端B的直接连接，具体的“打洞”过程如下：</p> <ul><li>A最初不知道如何向客户端B发起连接，于是A向集中服务器发送消息，请求集中服务器帮助建立与客户端B的UDP连接。</li> <li>集中服务器将含有B的外网和内网的地址二元组发给A，同时，集中服务器将包含有A的外网和内网的地址二元组信息的消息也发给B。这样一来， A与B就都知道对方外网和内网的地址二元组信息了。</li> <li>当A收到由集中服务器发来的包含B的外网和内网的地址二元组信息后， A开始向B的地址二元组发送UDP数据包，并且A会自动锁定第一个给出响应的B的地址二元组。同理，当B收到由集中服务器发来的A的外网和内网地址二元组信息后，也会开始向A的外网和内网的地址二元组发送UDP数据包，并且自动锁定第一个得到A回应的地址二元组。由于A与B互相向对方发送UDP数据包的操作是异步的，所以A和B发送数据包的时间先后并没有时序要求。</li></ul> <p>下面来看下这三者之间是如何进行UDP打洞的。在这我们分三种具体情景来讨论：</p> <ul><li>第一种是最简单的一种情景，两个客户端都位于同一个NAT设备后面，即位于同一内网中；</li> <li>第二种是最普遍的一种情景，两个客户端分别位于不同的NAT设备后面，分属不同的内网；</li> <li>第三种是客户端位于两层NAT设备之后，通常最上层的NAT是由网络提供商提供的，第二层NAT是家用的NAT路由器之类的设备提供的。</li></ul> <h3 id="典型p2p情景1-两客户端位于同一nat设备后面"><a href="#典型p2p情景1-两客户端位于同一nat设备后面" class="header-anchor">#</a> 典型P2P情景1:两客户端位于同一NAT设备后面</h3> <p>这是最简单的一种情况（如图所示）：客户端A和B分别与集中服务器建立UDP连接，经过NA</p> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220705/image.3vhdv4z7fxg0.webp" loading="lazy" class="lazy"></p> <ul><li>client A与Server S建立UDP连接，公共NAT（155.99.25.11）给client A分配一个公网端口62000；</li> <li>client B与Server S建立UDP连接，公共NAT（155.99.25.11）给client B分配一个公网端口62005；</li> <li>client A通过Server S发送一个消息要求连接client B，S给A回应B的公网和私网地址，并转发A的公网和私网地址给B；</li> <li>A和B根据获取的地址试图直接发送UDP数据报文；是否成功取决于NAT设备是否支持hairpin translation（端口回流）。打开端口回流相当于与client A的数据经过NAT设备转发后才到达client B，即从外网NAT接口绕了一圈（不会去服务器）再访问到同一个子网里的client B。（优点是可以防止内部攻击）</li></ul> <p>详细流程：</p> <ul><li>当A向集中服务器发出消息请求与B进行连接，集中服务器将B的外网地址二元组以及内网地址二元组发给A，同时把A的外网以及内网的地址二元组信息发给B。</li> <li>A和B发往对方公网地址二元组信息的UDP数据包不一定会被对方收到，这取决于当前的NAT设备是否支持不同端口之间的UDP数据包能否到达（即Hairpin转换特性），</li> <li>无论如何A与B发往对方内网的地址二元组信息的UDP数据包是一定可以到达的，内网数据包不需要路由，且速度更快。A与B推荐采用内网的地址二元组信息进行常规的P2P通信。</li> <li>假定NAT设备支持 Hairpin 转换，P2P双方也应忽略与内网地址二元组的连接，如果A 和B采用外网的地址二元组做为P2P通信的连接，这势必会造成数据包无谓地经过NAT设备，这是一种对资源的浪费。就目前的网络情况而言，应用程序在“打洞”的时候，最好还是把外网和内网的地址二元组都尝试一下。如果都能成功，优先以内网地址进行连接。</li></ul> <p>总结:</p> <ol><li>A、B都获取了对端的内网、外网地址。</li> <li>A、B可以直接通过内网地址直接通信（因为在同一个NAT网关后面，通过内网接口直接通信（直接通过交换机转发通信），效率高）。</li> <li>如果NAT网关支持Hairpin技术，就表示A、B通信可以通过NAT的外网接口进行通信（A-&gt;NAT内网接口1-&gt;NAT外网接口1-&gt;NAT外网接口2-&gt;NAT内网接口2-&gt;B),通过外网地址的访问可以防止内部攻击。</li></ol> <div class="custom-block tip"><p class="custom-block-title">扩展</p> <p><strong>什么是Hairpin技术？</strong></p> <p>Hairpin技术又被称为Hairpin NAT、Loopback NAT或Hairpin Translation。Hairpin技术需要NAT网关支持，它能够让两台位于同一台NAT网关后面的主机，通过对方的公网地址和端口相互访问，NAT网关会根据一系列规则，将对内部主机发往其NAT公网IP地址的报文进行转换，并从私网接口发送给目标主机。目前有很多NAT设备不支持该技术，这种情况下，NAT网关在一些特定场合下将会阻断P2P穿越NAT的行为，打洞的尝试是无法成功的。好在现在已经有越来越多的NAT设备商开始加入到对该转换的支持中来。</p></div> <h3 id="典型p2p情景2-两客户端位于不同的nat设备后面"><a href="#典型p2p情景2-两客户端位于不同的nat设备后面" class="header-anchor">#</a> 典型P2P情景2:两客户端位于不同的NAT设备后面</h3> <p>这是最普遍的一种情况（如图5所示）：客户端A与B经由各自的NAT设备与集中服务器建立UDP连接。</p> <ul><li>客户端A——&gt;本地IP:10.0.0.1，本地端口:4321，外网IP:155.99.25.11，外网端口:62000</li> <li>客户端B——&gt;本地IP:10.1.1.3，本地端口:4321，外网IP:138.76.29.7，外网端口:31000</li></ul> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220705/image.2m0ipb9tfes0.webp" loading="lazy" class="lazy"></p> <p>流程：</p> <ul><li>注册内外网地址二元组：在A向服务器发送的登陆消息中，包含有A的内网地址二元组信息，即10.0.0.1:4321；服务器会记录下A的内网地址二元组信息，同时会把自己观察到的A的外网地址二元组信息记录下来。同理，服务器也会记录下B的内网地址二元组信息和由服务器观察到的客户端B的外网地址二元组信息。</li> <li>交互内外网地址二元组：无论A与B二者中的任何一方向服务器发送P2P连接请求，服务器都会将其记录下来的上述的外网和内网地址二元组发送给A或B。</li> <li>A和B分属不同的内网，它们的内网地址在外网中是没有路由的，所以发往各自内网地址的UDP数据包会发送到错误的主机或者根本不存在的主机上。（也会同情景1一样，发送到内网地址中，但是这个地址可能错误/不存在，即便地址存在，对方也不会接收这个数据）</li> <li>当A的第一个消息发往B的外网地址（如图所示），该消息途经A的NAT设备，并在该设备上生成一个会话表项，该会话的源地址二元组信息是{10.0.0.1:4321}，和A与服务器建立连接的时候NAT生成的源地址二元组信息一样，但它的目的地址是B的外网地址。</li> <li>在A的NAT设备支持保留A的内网地址二元组信息的情况下，所有来自A的源地址二元组信息为{10.0.0.1:4321}的数据包都沿用A与集中服务器事先建立起来的会话，这些数据包的外网地址二元组信息均被映射为{155.99.25.11:62000}。</li> <li>A向B的外网地址发送消息的过程就是“打洞”的过程，从A的内网的角度来看应为从{10.0.0.1:4321}发往{138.76.29.7:31000}，从A在其NAT设备上建立的会话来看，是从{155.99.25.11:62000}发到{138.76.29.7:31000}。</li> <li>如果A发给B的外网地址二元组的消息包在B向A发送消息包之前到达B的NAT设备，B的NAT设备会认为A发过来的消息是未经授权的外网消息，并丢弃该数据包。（但是A对应的NAT建立了与B的映射，后面B发送过来的数据是可以通过的）</li> <li>B发往A的消息包也会在B的NAT设备上建立一个{10.1.1.3:4321，155.99.25.11:62000}的会话（通常也会沿用B与集中服务器连接时建立的会话，只是该会话现在不仅接受由服务器发给B的消息，还可以接受从A的NAT设备{155.99.25.11:6200}发来的消息）。</li> <li>一旦A与B都向对方的NAT设备在外网上的地址二元组发送了数据包，就打开了A与B之间的“洞”，A与B向对方的外网地址发送数据，等效为向对方的客户端直接发送UDP数据包了。</li> <li>一旦应用程序确认已经可以通过往对方的外网地址发送数据包的方式让数据包到达NAT后面的目的应用程序，程序会自动停止继续发送用于“打洞”的数据包，转而开始真正的P2P数据传输。</li></ul> <h3 id="典型p2p情景3-两客户端位于两层-或多层-nat设备之后"><a href="#典型p2p情景3-两客户端位于两层-或多层-nat设备之后" class="header-anchor">#</a> 典型P2P情景3:两客户端位于两层(或多层)NAT设备之后</h3> <p>此种情景最典型的部署情况就像这样：最上层的NAT设备通常是由网络提供商（ISP）提供，下层NAT设备是家用路由器。</p> <p>如下图所示：假定NAT C是由ISP提供的NAT设备，NAT C提供将多个用户节点映射到有限的几个公网IP的服务，NAT A和NAT B作为NAT C的内网节点将把用户的内部网络接入NAT C的内网，用户的内部网络就可以经由NAT C访问公网了。</p> <p>从这种拓扑结构上来看，只有服务器与NAT C是真正拥有公网可路由IP地址的设备，而NAT A和NAT B所使用的公网IP地址，实际上是由ISP服务提供商设定的（相对于NAT C而言）内网地址（我们将这种由ISP提供的内网地址称之为<strong>伪公网地址</strong>）。</p> <p>同理，隶属于NAT A与NAT B的客户端，它们处于NAT A，NAT B的内网，以此类推，客户端可以放到到多层NAT设备后面。</p> <p><strong>客户端A和客户端B发起对服务器S的连接的时候，就会依次在NAT A和NAT B上建立向外的Session，而NAT A、NAT B要联入公网的时候，会在NAT C上再建立向外的Session。</strong></p> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220705/image.6j52cixd2ag0.webp" loading="lazy" class="lazy"></p> <p>现在假定客户端A和B希望通过UDP“打洞”完成两个客户端的P2P直连。最优化的路由策略是客户端A向客户端B的“伪公网”IP上发送数据包，即ISP服务提供商指定的内网IP，NAT B的“伪”公网地址二元组，{10.0.1.2:55000}。</p> <p>由于从服务器的角度<strong>只能观察到真正的公网地址</strong>，也就是NAT A，NAT B在NAT C建立session的真正的公网地址{155.99.25.11:62000}以及{155.99.25.11:62005}，非常不幸的是客户端A与客户端B是无法通过服务器知道这些“伪”公网的地址，而且即使客户端A和B通过某种手段可以得到NAT A和NAT B的“伪”公网地址，我们仍然不建议采用上述的“最优化”的打洞方式，这是因为这些地址是由ISP服务提供商提供的<strong>或许会存在与客户端本身所在的内网地址重复的可能性</strong>（例如:NAT A的内网的IP地址域恰好与NAT A在NAT C的“伪”公网IP地址域重复，这样就会导致打洞数据包无法发出的问题）。因此客户端别无选择，只能使用由公网服务器观察到的A，B的公网地址二元组进行“打洞”操作，用于“打洞”的数据包将由NAT C进行转发。</p> <p>流程：</p> <ul><li>当客户端A向客户端B的公网地址二元组{155.99.25.11:62005}发送UDP数据包的时候，NAT A首先把数据包的源地址二元组由A的内网地址二元组{10.0.0.1:4321}转换为“伪”公网地址二元组{10.0.1.1:45000}，现在数据包到了NAT C，NAT C应该可以识别出来该数据包是要发往自身转换过的公网地址二元组，如果NAT C可以给出“合理”响应的话，NAT C将把该数据包的源地址二元组改为{155.99.25.11:62000}，目的地址二元组改为{10.0.1.2:55000}，即NAT B的“伪”公网地址二元组，NAT B最后会将收到的数据包发往客户端B。</li> <li>同样，由B发往A的数据包也会经过类似的过程。目前也有很多NAT设备不支持类似这样的“Hairpin转换”，但是已经有越来越多的NAT设备商开始加入对该转换的支持中来。</li></ul> <h3 id="现实问题-udp在空闲状态下的超时"><a href="#现实问题-udp在空闲状态下的超时" class="header-anchor">#</a> 现实问题:UDP在空闲状态下的超时</h3> <p>当然，从应用的角度上来说，在完成打洞过程的同时，还有一些技术问题需要解决，如<strong>UDP在空闲状态下的超时问题</strong>。</p> <p>由于UDP转换协议提供的“洞”不是绝对可靠的，多数NAT设备内部都有一个UDP转换的<strong>空闲状态计时器</strong>，如果在一段时间内没有UDP数据通信，NAT设备会关掉由“打洞”过程打出来的“洞”。如果P2P应用程序希望“洞”的存活时间不受NAT网关的限制，就最好在穿越NAT以后<strong>设定一个穿越的有效期</strong>。</p> <p>对于有效期目前没有标准值，它与NAT设备内部的配置有关，某些设备上最短的只有20秒左右。在这个有效期内，即使没有P2P数据包需要传输，应用程序为了维持该“洞”可以正常工作，也必须向对方<strong>发送“打洞”心跳包</strong>。</p> <p>这个心跳包是需要双方应用程序都发送的，<strong>只有一方发送不会维持另一方的Session正常工作</strong>。除了频繁发送“打洞”心跳包以外，还有一个方法就是<strong>在当前的“洞”超时之前，P2P客户端双方重新“打洞”</strong>，丢弃原有的“洞”，这也不失为一个有效的方法。</p> <h2 id="基于tcp协议的p2p打洞技术"><a href="#基于tcp协议的p2p打洞技术" class="header-anchor">#</a> 基于TCP协议的P2P打洞技术</h2> <p>建立穿越NAT设备的P2P的TCP连接只比UDP复杂一点点，TCP协议的“打洞”从协议层来看是与UDP的“打洞”过程非常相似的。尽管如此，基于TCP协议的打洞至今为止还没有被很好的理解，这也造成了的对其提供支持的NAT设备不是很多。在NAT设备支持的前提下，基于TCP的“打洞”技术实际上与基于UDP的“打洞”技术一样快捷、可靠。实际上，只要NAT设备支持的话，基于TCP的P2P技术的健壮性将比基于UDP技术的更强一些，因为TCP协议的状态机给出了一种标准的方法来<strong>精确的获取某个TCP session的生命期</strong>，而UDP协议则无法做到这一点。</p> <h3 id="套接字和tcp端口的重用"><a href="#套接字和tcp端口的重用" class="header-anchor">#</a> 套接字和TCP端口的重用</h3> <p>实现基于TCP协议的P2P打洞过程中，最主要的问题不是来自于TCP协议，而是来自于应用程序的API接口。这是由于标准的伯克利(Berkeley)套接字的API是围绕着构建客户端/服务器程序而设计的，API允许TCP流套接字通过调用connect()函数来建立向外的连接，或者通过listen()和accept函数接受来自外部的连接，但是，API不提供类似UDP那样的，同一个端口<strong>既可以向外连接，又能够接受来自外部的连接</strong>。而且更糟的是，TCP的套接字<strong>通常仅允许建立1对1的响应</strong>，即应用程序在将一个套接字绑定到本地的一个端口以后，任何试图将第二个套接字绑定到该端口的操作都会失败。</p> <p>为了让TCP“打洞”能够顺利工作，我们需要<strong>使用一个本地的TCP端口来监听来自外部的TCP连接，同时建立多个向外的TCP连接</strong>。幸运的是，所有的主流操作系统都能够支持特殊的TCP套接字参数，通常叫做·“<code>SO_REUSEADDR</code>”，该参数允许应用程序将多个套接字绑定到本地的一个地址二元组（只要所有要绑定的套接字都设置了SO_REUSEADDR参数即可）。BSD系统引入了SO_REUSEPORT参数，该参数用于区分端口重用还是地址重用，在这样的系统里面，上述所有的参数必须都设置才行。</p> <h3 id="打开p2p的tcp流"><a href="#打开p2p的tcp流" class="header-anchor">#</a> 打开P2P的TCP流</h3> <p>假定客户端A希望建立与B的TCP连接。我们像通常一样假定A和B已经与公网上的已知服务器建立了TCP连接。服务器记录下来每个接入的客户端的公网和内网的地址二元组，如同为UDP服务的时候一样。</p> <p>从协议层来看，TCP“打洞”与UDP“打洞”是几乎完全相同的过程：</p> <ul><li>客户端A使用其与服务器的连接向服务器发送请求，要求服务器协助其连接客户端B；</li> <li>服务器将B的公网和内网的TCP地址的二元组信息返回给A，同时，服务器将A的公网和内网的地址二元组也发送给B；</li> <li>客户端A和B使用连接服务器的端口异步地发起向对方的公网、内网地址二元组的TCP连接，同时监听各自的本地TCP端口是否有外部的连接联入；</li> <li>A和B开始等待向外的连接是否成功，检查是否有新连接联入。如果向外的连接由于某种网络错误而失败，如：“连接被重置”或者“节点无法访问”，客户端只需要延迟一小段时间（例如延迟一秒钟），然后重新发起连接即可，延迟的时间和重复连接的次数可以由应用程序编写者来确定；</li> <li>TCP连接建立起来以后，客户端之间应该开始鉴权操作，确保目前联入的连接就是所希望的连接。如果鉴权失败，客户端将关闭连接，并且继续等待新的连接联入。客户端通常采用“先入为主”的策略，只接受第一个通过鉴权操作的客户端，然后将进入P2P通信过程不再继续等待是否有新的连接联入。</li></ul> <p><img alt="image" data-src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/20220705/image.4p9noyc2ck20.webp" loading="lazy" class="lazy"></p> <p>与UDP不同的是，因为使用UDP协议的每个客户端只需要一个套接字即可完成与服务器的通信，而TCP客户端必须处理多个套接字绑定到同一个本地TCP端口的问题，如图7所示。现在来看实际中常见的一种情景，A与B分别位于不同的NAT设备后面，如图5所示，并且假定图中的端口号是TCP协议的端口号，而不是UDP的端口号。图中向外的连接代表A和B向对方的内网地址二元组发起的连接，这些连接或许会失败或者无法连接到对方。如同使用UDP协议进行“打洞”操作遇到的问题一样，TCP的“打洞”操作也会遇到内网的IP与“伪”公网IP重复造成连接失败或者错误连接之类的问题。</p> <p>客户端向彼此公网地址二元组发起连接的操作，会使得各自的NAT设备打开新的“洞”允许A与B的TCP数据通过。如果NAT设备支持TCP“打洞”操作的话，一个在客户端之间的基于TCP协议的流通道就会自动建立起来。如果A向B发送的第一个SYN包发到了B的NAT设备，而B在此前没有向A发送SYN包，B的NAT设备会丢弃这个包，这会引起A的“连接失败”或“无法连接”问题。而此时，由于A已经向B发送过SYN包，B发往A的SYN包将被看作是由A发往B的包的回应的一部分，所以B发往A的SYN包会顺利地通过A的NAT设备，到达A，从而建立起A与B的P2P连接。</p> <h3 id="从应用程序的角度来看tcp-打洞"><a href="#从应用程序的角度来看tcp-打洞" class="header-anchor">#</a> 从应用程序的角度来看TCP“打洞”</h3> <p>从应用程序的角度来看，在进行TCP“打洞”的时候都发生了什么呢？假定A首先向B发出SYN包，该包发往B的公网地址二元组，并且被B的NAT设备丢弃，但是B发往A的公网地址二元组的SYN包则通过A的NAT到达了A，然后，会发生以下的两种结果中的一种，具体是哪一种取决于操作系统对TCP协议的实现：</p> <ul><li><p>A的TCP实现会发现收到的SYN包就是其发起连接并希望联入的B的SYN包，通俗一点来说就是“说曹操，曹操到”的意思，本来A要去找B，结果B自己找上门来了。A的TCP协议栈因此会把B作为A向B发起连接connect的一部分，并认为连接已经成功。程序A调用的异步connect()函数将成功返回，A的listen()等待从外部联入的函数将没有任何反映。此时，B联入A的操作在A程序的内部被理解为A联入B连接成功，并且A开始使用这个连接与B开始P2P通信。
由于收到的SYN包中不包含A需要的ACK数据，因此，A的TCP将用SYN-ACK包回应B的公网地址二元组，并且将使用先前A发向B的SYN包一样的序列号。一旦B的TCP收到由A发来的SYN-ACK包，则把自己的ACK包发给A，然后两端建立起TCP连接。简单的说，第一种，就是即使A发往B的SYN包被B的NAT丢弃了，但是由于B发往A的包到达了A。结果是，A认为自己连接成功了，B也认为自己连接成功了，不管是谁成功了，总之连接是已经建立起来了。</p></li> <li><p>另外一种结果是，A的TCP实现没有像（1）中所讲的那么“智能”，它没有发现现在联入的B就是自己希望联入的。就好比在机场接人，明明遇到了自己想要接的人却不认识，误认为是其他的人，安排别人给接走了，后来才知道是自己错过了机会，但是无论如何，人已经接到了任务已经完成了。然后，A通过常规的listen()函数和accept()函数得到与B的连接，而由A发起的向B的公网地址二元组的连接会以失败告终。尽管A向B的连接失败，A仍然得到了B发起的向A的连接，等效于A与B之间已经联通，不管中间过程如何，A与B已经连接起来了，结果是A和B的基于TCP协议的P2P连接已经建立起来了。</p></li></ul> <p>第一种结果适用于基于BSD的操作系统对于TCP的实现，而第二种结果更加普遍一些，多数Linux和Windows系统都会按照第二种结果来处理。</p> <h2 id="本文小结"><a href="#本文小结" class="header-anchor">#</a> 本文小结</h2> <p>在IP地址极度短缺的今天，NAT几乎已经是无所不在的一项技术了，以至于现在任何一项新技术都不得不考虑和NAT的兼容。作为当下应用最广泛的技术之一，P2P技术也必然要面对NAT这个障碍。</p> <p>打洞技术看起来是一项近似乎蛮干的技术，却不失为一种有效的技术手段。在集中服务器的帮助下，P2P的双方利用端口预测的技术在NAT网关上打出通道，从而实现NAT穿越，解决了NAT对于P2P的阻隔，为P2P技术在网络中更广泛的推广作出了非常大的贡献。</p> <h2 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h2> <p>本文转载自<a href="http://www.52im.net/thread-542-1-1.html" target="_blank" rel="noopener noreferrer">P2P技术详解(二)：P2P中的NAT穿越(打洞)方案详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/jonsam-ng/fancy-webrtc/edit/master/docs/20.基础/35.P2P/10.NAT 类型探测和 NAT 穿越.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=NAT%20%E6%8E%A2%E6%B5%8B" title="标签">#NAT 探测</a><a href="/tags/?tag=NAT%20%E7%A9%BF%E8%B6%8A" title="标签">#NAT 穿越</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/07/11, 09:43:09</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/basic/p2p/nat-basic/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">NAT基础概念详解</div></a> <a href="/basic/p2p/nat-advance/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">NAT穿越方案进阶</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/basic/p2p/nat-basic/" class="prev">NAT基础概念详解</a></span> <span class="next"><a href="/basic/p2p/nat-advance/">NAT穿越方案进阶</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/basic/p2p/stun/"><div>
            STUN 详解
            <!----></div></a> <span class="date">07-21</span></dt></dl><dl><dd>02</dd> <dt><a href="/source/api/index/"><div>
            本章导读
            <!----></div></a> <span class="date">07-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/source/category/"><div>
            目录结构
            <!----></div></a> <span class="date">07-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:jonsam.ng@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jonsam-ng" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.jonsam.site" title="博客" target="_blank" class="iconfont icon-mao"></a><a href="https://docs.jonsam.site" title="文档" target="_blank" class="iconfont icon-shuben"></a><a href="https://source.jonsam.site" title="源码" target="_blank" class="iconfont icon-code"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Fancy WebRTC | Template by <a href="https://jonsam-ng.github.io/fancy-note-starter/">Fancy Note Starter</a> | Made by <a href=https://www.jonsam.site target="_blank">jonsam</a> with ❤</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div><!----><!----><!----><div></div><div></div></div></div>
    <script src="/assets/js/app.2b835d01.js" defer></script><script src="/assets/js/11.8f8d8c94.js" defer></script><script src="/assets/js/46.26125c7a.js" defer></script><script src="/assets/js/16.2ef6dce7.js" defer></script><script src="/assets/js/21.8f4f04c1.js" defer></script><script src="/assets/js/19.7a274e56.js" defer></script><script src="/assets/js/20.cc7484e4.js" defer></script><script src="/assets/js/15.daa60dcc.js" defer></script><script src="/assets/js/13.f9165900.js" defer></script>
  </body>
</html>
