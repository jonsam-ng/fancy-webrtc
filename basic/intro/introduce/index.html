<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebRTC 概要介绍 | Fancy WebRTC</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3314748_9xij1pv3h4i.css">
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/img/manifest.json">
    <link rel="apple-touch-icon" href="/img/android-chrome-192x192.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="WebRTC notes and learning map all you want.">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="webRTC学习,webRTC教程,webRTC入门">
    <meta name="theme-color" content="#008ACB">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.fa1913f3.css" as="style"><link rel="preload" href="/assets/js/app.2b835d01.js" as="script"><link rel="preload" href="/assets/js/11.8f8d8c94.js" as="script"><link rel="preload" href="/assets/js/36.f2070bed.js" as="script"><link rel="preload" href="/assets/js/16.2ef6dce7.js" as="script"><link rel="preload" href="/assets/js/21.8f4f04c1.js" as="script"><link rel="preload" href="/assets/js/19.7a274e56.js" as="script"><link rel="preload" href="/assets/js/20.cc7484e4.js" as="script"><link rel="preload" href="/assets/js/15.daa60dcc.js" as="script"><link rel="preload" href="/assets/js/13.f9165900.js" as="script"><link rel="prefetch" href="/assets/js/1.2068c1db.js"><link rel="prefetch" href="/assets/js/12.a86359d8.js"><link rel="prefetch" href="/assets/js/14.5bcc0334.js"><link rel="prefetch" href="/assets/js/17.8c318acc.js"><link rel="prefetch" href="/assets/js/18.7f4f6ced.js"><link rel="prefetch" href="/assets/js/22.8e03dbef.js"><link rel="prefetch" href="/assets/js/23.ae5d7b1a.js"><link rel="prefetch" href="/assets/js/24.a07e377d.js"><link rel="prefetch" href="/assets/js/25.ae45a243.js"><link rel="prefetch" href="/assets/js/26.292813ba.js"><link rel="prefetch" href="/assets/js/27.b5422518.js"><link rel="prefetch" href="/assets/js/28.5b569d05.js"><link rel="prefetch" href="/assets/js/29.e406c2e9.js"><link rel="prefetch" href="/assets/js/30.0eba634f.js"><link rel="prefetch" href="/assets/js/31.4f67e3d8.js"><link rel="prefetch" href="/assets/js/32.9e0293ef.js"><link rel="prefetch" href="/assets/js/33.7c756595.js"><link rel="prefetch" href="/assets/js/34.335b4f17.js"><link rel="prefetch" href="/assets/js/35.01786aab.js"><link rel="prefetch" href="/assets/js/37.7c70043c.js"><link rel="prefetch" href="/assets/js/38.303adcdf.js"><link rel="prefetch" href="/assets/js/39.39b0a121.js"><link rel="prefetch" href="/assets/js/40.27cf0425.js"><link rel="prefetch" href="/assets/js/41.60cc5ac0.js"><link rel="prefetch" href="/assets/js/42.48c15345.js"><link rel="prefetch" href="/assets/js/43.836eadb6.js"><link rel="prefetch" href="/assets/js/44.f83a74c1.js"><link rel="prefetch" href="/assets/js/45.1325bd73.js"><link rel="prefetch" href="/assets/js/46.26125c7a.js"><link rel="prefetch" href="/assets/js/47.d8603164.js"><link rel="prefetch" href="/assets/js/48.6a5f1eab.js"><link rel="prefetch" href="/assets/js/49.2d88e192.js"><link rel="prefetch" href="/assets/js/50.e1d6d683.js"><link rel="prefetch" href="/assets/js/51.5204c164.js"><link rel="prefetch" href="/assets/js/52.890170b0.js"><link rel="prefetch" href="/assets/js/53.7d5218da.js"><link rel="prefetch" href="/assets/js/54.081d6d8a.js"><link rel="prefetch" href="/assets/js/55.9193e648.js"><link rel="prefetch" href="/assets/js/56.c283c363.js"><link rel="prefetch" href="/assets/js/57.36ca963e.js"><link rel="prefetch" href="/assets/js/58.ca50e853.js"><link rel="prefetch" href="/assets/js/59.1dfc405f.js"><link rel="prefetch" href="/assets/js/60.a6aafe70.js"><link rel="prefetch" href="/assets/js/61.35b09da6.js"><link rel="prefetch" href="/assets/js/62.d9905bc4.js"><link rel="prefetch" href="/assets/js/63.f502a4a5.js"><link rel="prefetch" href="/assets/js/64.63cb0948.js"><link rel="prefetch" href="/assets/js/65.15922937.js"><link rel="prefetch" href="/assets/js/66.0f2a61bf.js"><link rel="prefetch" href="/assets/js/67.b9bb6554.js"><link rel="prefetch" href="/assets/js/68.c993ab07.js"><link rel="prefetch" href="/assets/js/69.16e4d5cd.js"><link rel="prefetch" href="/assets/js/70.453a604a.js"><link rel="prefetch" href="/assets/js/71.57070527.js"><link rel="prefetch" href="/assets/js/72.7edf97b7.js"><link rel="prefetch" href="/assets/js/73.cb826c97.js"><link rel="prefetch" href="/assets/js/74.f40761ed.js"><link rel="prefetch" href="/assets/js/75.a8fde850.js"><link rel="prefetch" href="/assets/js/76.71255e54.js"><link rel="prefetch" href="/assets/js/77.de20ce37.js"><link rel="prefetch" href="/assets/js/78.91afa182.js"><link rel="prefetch" href="/assets/js/79.5ec162b8.js"><link rel="prefetch" href="/assets/js/80.81ba4a79.js"><link rel="prefetch" href="/assets/js/81.dd9dad97.js"><link rel="prefetch" href="/assets/js/82.5d12f510.js"><link rel="prefetch" href="/assets/js/83.14bee419.js"><link rel="prefetch" href="/assets/js/84.f01335e5.js"><link rel="prefetch" href="/assets/js/vendors~aplayer.ef69e8c8.js"><link rel="prefetch" href="/assets/js/vendors~artplayer.9f457d6b.js"><link rel="prefetch" href="/assets/js/vendors~dash.c779a1b8.js"><link rel="prefetch" href="/assets/js/vendors~dplayer.008e957a.js"><link rel="prefetch" href="/assets/js/vendors~hls.18d1f653.js"><link rel="prefetch" href="/assets/js/vendors~mpegts.02ab45df.js"><link rel="prefetch" href="/assets/js/vendors~shaka-player.f723bd71.js"><link rel="prefetch" href="/assets/js/vendors~webtorrent.271bb3b6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fa1913f3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Fancy WebRTC" class="logo"> <span class="site-name can-hide">Fancy WebRTC</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/advance/" class="nav-link">进阶</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="话题" class="dropdown-title"><a href="/topic/" class="link-title">话题</a> <span class="title" style="display:none;">话题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonsam-ng/fancy-webrtc-demos" target="_blank" rel="noopener noreferrer" class="nav-link external">
  实例
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/source/index/" class="nav-link">源码</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ox.jonsam.site/tags/?tag=WebRTC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  书籍资料
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">幻灯片</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-webrtc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/jonsam-ng/image-hosting@master/oxygen-space/image.5a0lthv367k0.png"> <div class="blogger-info"><h3>Jonsam NG</h3> <span>让有意义的事变得有意思，让有意思的事变得有意义</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/basic/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/advance/" class="nav-link">进阶</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="话题" class="dropdown-title"><a href="/topic/" class="link-title">话题</a> <span class="title" style="display:none;">话题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/jonsam-ng/fancy-webrtc-demos" target="_blank" rel="noopener noreferrer" class="nav-link external">
  实例
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/source/index/" class="nav-link">源码</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://ox.jonsam.site/tags/?tag=WebRTC" target="_blank" rel="noopener noreferrer" class="nav-link external">
  书籍资料
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li><li class="dropdown-item"><!----> <a href="/slides/#/1" class="nav-link">幻灯片</a></li></ul></div></div><div class="nav-item"><a href="https://www.jonsam.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/jonsam-ng/fancy-webrtc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/basic/index/" class="sidebar-link">开始上手</a></li><li><a href="/basic/plan/" class="sidebar-link">Plan 计划</a></li><li><a href="/basic/roadmap/" class="sidebar-link">Roadmap 路线</a></li><li><a href="/basic/webrtc-1.0/" class="sidebar-link">WebRTC1.0浏览器间实时通讯</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MDN: WebRTC API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>概要</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic/intro/index/" class="sidebar-link">本章导读</a></li><li><a href="/basic/intro/introduce/" aria-current="page" class="active sidebar-link">WebRTC 概要介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#什么是-webrtc" class="sidebar-link">什么是 WebRTC？</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#webrtc-可以做什么" class="sidebar-link">WebRTC 可以做什么？</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#难点" class="sidebar-link">难点</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#webrtc与ffmpeg" class="sidebar-link">WebRTC与FFmpeg</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#应用流程" class="sidebar-link">应用流程</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#新功能" class="sidebar-link">新功能</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#原理与架构" class="sidebar-link">原理与架构</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#webrtc-api" class="sidebar-link">WebRTC API</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#媒体设备使用入门" class="sidebar-link">媒体设备使用入门</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#媒体捕获和约束" class="sidebar-link">媒体捕获和约束</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#开始使用对等连接" class="sidebar-link">开始使用对等连接</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#远程数据流" class="sidebar-link">远程数据流</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#数据通道" class="sidebar-link">数据通道</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#turn-服务器" class="sidebar-link">TURN 服务器</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#测试-webrtc-应用" class="sidebar-link">测试 WebRTC 应用</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#webrtc运行机制" class="sidebar-link">WebRTC运行机制</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#声明" class="sidebar-link">声明</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#实例" class="sidebar-link">实例</a></li><li class="sidebar-sub-header level2"><a href="/basic/intro/introduce/#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/basic/intro/stats/" class="sidebar-link">读懂 WebRTC's Statistics API</a></li><li><a href="/basic/intro/session/" class="sidebar-link">WebRTC 中的三角形和梯形会话</a></li><li><a href="/basic/intro/dict/" class="sidebar-link">Webrtc Statistics Dictionary</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>应用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>P2P</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>协议</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-3f4da221><div class="articleInfo" data-v-3f4da221><ul class="breadcrumbs" data-v-3f4da221><li data-v-3f4da221><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-3f4da221></a></li> <li data-v-3f4da221><a href="/categories/?category=%E5%9F%BA%E7%A1%80" title="分类" data-v-3f4da221>基础</a></li><li data-v-3f4da221><a href="/categories/?category=%E6%A6%82%E8%A6%81" title="分类" data-v-3f4da221>概要</a></li></ul> <div class="info" data-v-3f4da221><div title="作者" class="author iconfont icon-touxiang" data-v-3f4da221><a href="https://github.com/jonsam-ng" target="_blank" title="作者" class="beLink" data-v-3f4da221>jonsam</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-3f4da221><a href="javascript:;" data-v-3f4da221>2022-06-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">WebRTC 概要介绍<!----></h1>  <div class="theme-vdoing-content content__default"><div class="badge-group" data-v-ac1337e0><span class="group-tag" data-v-ac1337e0>标签：</span> <span class="badge tip" style="vertical-align:top;" data-v-ac1337e0 data-v-6223a86a>重要</span></div> <!----> <h2 id="什么是-webrtc"><a href="#什么是-webrtc" class="header-anchor">#</a> 什么是 WebRTC？</h2> <p><strong>面向网络的实时通信</strong>：</p> <p>借助 WebRTC，您可以为应用添加基于开放标准运行的实时通信功能。它支持在对等设备之间发送视频、语音和通用数据，使开发者能够构建强大的语音和视频通信解决方案。这项技术适用于所有现代浏览器以及所有主要平台的原生客户端。WebRTC 采用的技术是开放网络标准，以常规 JavaScript API 的形式在所有主流浏览器中提供。对于原生客户端（例如 Android 和 iOS 应用），可以使用具备相同功能的库。</p> <p>特点：</p> <ul><li>音视频处理+即时通讯的开源库</li> <li>2010 年 Google 将其开源</li> <li>优秀的多媒体框架，跨平台</li></ul> <h2 id="webrtc-可以做什么"><a href="#webrtc-可以做什么" class="header-anchor">#</a> WebRTC 可以做什么？</h2> <p>将WebRTC加入浏览器，使得浏览器的功能更加强大。WebRTC（Web Real-Time Communication）项目的最终目的主要是让Web开发者能够基于浏览器（Chrome\FireFox...）轻易快捷开发出丰富的实时多媒体应用，而无需下载安装任何插件，Web开发者也无需关注多媒体的数字信号处理过程，只需编写简单的Javascript程序即可实现，W3C等组织正在制定Javascript 标准API，目前是WebRTC 1.0版本即Draft状态；另外WebRTC还希望能够建立一个多互联网浏览器间健壮的实时通信的平台，形成开发者与浏览器厂商良好的生态环境。同时，Google也希望和致力于让WebRTC的技术成为HTML5标准之一，可见Google布局之深远。</p> <p>WebRTC 有许多不同的用例，从使用摄像头或麦克风的基本 Web 应用，到更高级的视频通话应用和屏幕共享。</p> <ul><li>音视频实时互动</li> <li>游戏、即时通讯、文件传输等等</li> <li>传输、音视频处理（回音消除、降噪等）</li></ul> <p>WebRTC 的应用场景：</p> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.5zwnzkma4fo0.webp" loading="lazy" class="lazy"></p> <p>愿景：各浏览器之间可以快速开发可以实时互动的音视频的应用场景</p> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.5l3vlds90200.webp" loading="lazy" class="lazy"></p> <h2 id="难点"><a href="#难点" class="header-anchor">#</a> 难点</h2> <ul><li>过多的协议，WebRTC太庞大、烦杂，门槛高。</li> <li>客户端与服务端分离，WebRTC只有客户端，没有服务端，需要自己根据业务实现。</li> <li>相关资料少。</li> <li>网上代码错误太多。</li></ul> <h2 id="webrtc与ffmpeg"><a href="#webrtc与ffmpeg" class="header-anchor">#</a> WebRTC与FFmpeg</h2> <ul><li>WebRTC与FFmpeg是音视频领域的两个佼佼者，两个侧重点不同。</li> <li>FFmpeg侧重于多媒体文件的编辑，音视频的编解码等。</li> <li>WebRTC侧重于处理网络抖动、丢包、评估以及音频处理，回音降噪等等。</li></ul> <h2 id="应用流程"><a href="#应用流程" class="header-anchor">#</a> 应用流程</h2> <p>WebRTC 应用通常会经过常见的应用流程。访问媒体设备，打开对等连接，发现对等设备，并开始流式传输。</p> <h2 id="新功能"><a href="#新功能" class="header-anchor">#</a> 新功能</h2> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220629/image.4davm1k1ei80.webp" loading="lazy" class="lazy"></p> <h2 id="原理与架构"><a href="#原理与架构" class="header-anchor">#</a> 原理与架构</h2> <p>WebRTC实现了基于网页的视频会议，标准是 <strong>WHATWG 协议</strong>，目的是通过浏览器提供简单的javascript就可以达到实时通讯（Real-Time Communications (RTC)）能力。</p> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.3d662jaya8y0.webp" loading="lazy" class="lazy"></p> <p>WebRTC整体架构主要分为两部分：</p> <ul><li>第一部分为绿色区域，为webrtc库所提供的核心功能。</li> <li>第二部分为紫色区域，是浏览器提供的javascript的API层，也就是说浏览器对webrtc的核心层的C++ API做了一层封装，封装成为了javascript接口。</li> <li>第三部分为箭头区域，是很多的上层应用。</li> <li>调用顺序就是从上到下。</li></ul> <h3 id="核心层"><a href="#核心层" class="header-anchor">#</a> 核心层</h3> <p>分为如下4层：</p> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.4mbbeuk1wxo0.webp" loading="lazy" class="lazy"></p> <ul><li>第一层为<strong>C++ API</strong>，是WebRTC库提供给浏览器javascript层的核心功能API接口（比如：连接、P2P进行连接、传输质量、设备管理....）。</li> <li>第二层为<strong>Session层</strong>，上下文管理层，<strong>音频、视频、非音视频的数据传输，都通过session层处理</strong>，实现相关逻辑。</li> <li>第三层包括<strong>音频引擎、视频引擎、传输模块</strong>。</li> <li>第四层与硬件相关，包括音视频的采集、网络IO （可重载的，可以使用自己的方案）</li></ul> <p>注意：在webrtc中没有对视频进行渲染处理，所以需要我们在应用中自己实现。</p> <h3 id="引擎层"><a href="#引擎层" class="header-anchor">#</a> 引擎层</h3> <p>引擎层包括音频引擎、视频引擎、传输模块。将这3个模块分隔开来，逻辑更加清晰。另外音视频的同步不是在引擎层实现。</p> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.1ao3vgsw41vk.webp" loading="lazy" class="lazy"></p> <p>音频引擎：包含一系列<strong>音频多媒体处理</strong>的框架，包括<strong>从视频采集卡到网络传输端等整个解决方案</strong>。VoiceEngine是WebRTC极具价值的技术之一，是Google收购GIPS公司后开源的。</p> <h4 id="音频引擎"><a href="#音频引擎" class="header-anchor">#</a> 音频引擎</h4> <h5 id="编解码器"><a href="#编解码器" class="header-anchor">#</a> 编解码器</h5> <ul><li>iSAC（Internet Speech Audio Codec）：<strong>针对VoIP和音频流的宽带和超宽带音频编解码器</strong>，是WebRTC音频引擎的默认的编解码器。</li></ul> <div class="custom-block tip"><p class="custom-block-title">参数</p> <ul><li>采样频率：16khz，24khz，32khz；（默认为16khz）</li> <li>自适应速率为10kbit/s ~ 52kbit/s</li> <li>自适应包大小：30~60ms</li> <li>算法延时：frame + 3ms</li></ul></div> <ul><li>iLBC（Internet Low Bitrate Codec）：<strong>VoIP音频流的窄带语音编解码器</strong>。</li></ul> <div class="custom-block tip"><p class="custom-block-title">参数</p> <ul><li>采样频率：8khz；</li> <li>20ms帧比特率为15.2kbps</li> <li>30ms帧比特率为13.33kbps</li> <li>标准由IETF RFC3951和RFC3952定义</li></ul></div> <h5 id="防止抖动与丢失"><a href="#防止抖动与丢失" class="header-anchor">#</a> 防止抖动与丢失</h5> <p>NetEQ for Voice：<strong>针对音频软件实现的语音信号处理元件</strong>。</p> <p>NetEQ算法是自适应抖动控制算法以及语音包丢失隐藏算法。使其能够快速且高解析度地适应不断变化的网络环境，确保音质优美且缓冲延迟最小。
是GIPS公司独步天下的技术，能够有效的处理由于网络抖动和语音包丢失时候对语音质量产生的影响。</p> <p>NetEQ 也是WebRTC中一个极具价值的技术，对于提高VoIP质量有明显效果，加以<code>AEC\NR\AGC</code>等模块集成使用，效果更好。</p> <h5 id="回音消除、降噪"><a href="#回音消除、降噪" class="header-anchor">#</a> 回音消除、降噪</h5> <ul><li>Acoustic Echo Canceler (AEC) ：<strong>回声消除器</strong>是一个基于软件的信号处理元件，能实时的去除mic采集到的回声。</li> <li>Noise Reduction (NR)：<strong>噪声抑制</strong>也是一个基于软件的信号处理元件，用于消除与相关VoIP的某些类型的背景噪声（嘶嘶声，风扇噪音等等……）。</li></ul> <h4 id="视频引擎"><a href="#视频引擎" class="header-anchor">#</a> 视频引擎</h4> <p>视频引擎包含一系列视频处理的整体框架，从摄像头采集视频到视频信息网络传输再到视频显示整个完整过程的解决方案。</p> <ul><li>编解码器：视频图像编解码器，是WebRTC视频引擎的默认的编解码器。VP8适合实时通信应用场景，因为它主要是针对低延时而设计的编解码器。</li></ul> <div class="custom-block tip"><p class="custom-block-title">扩展</p> <p>VPx编解码器是Google收购ON2公司后开源的，VPx现在是WebM项目的一部分，而WebM项目是Google致力于推动的HTML5标准之一</p></div> <ul><li>视频抖动缓冲器：Video Jitter Buffer，可以<strong>降低由于视频抖动和视频信息包丢失带来的不良影响</strong>。</li> <li>图像质量增强模块：Image enhancements，<strong>对网络摄像头采集到的图像进行处理</strong>，包括明暗度检测、颜色增强、降噪处理等功能，用来提升视频质量。</li></ul> <h3 id="传输层"><a href="#传输层" class="header-anchor">#</a> 传输层</h3> <p><strong>底层使用UDP，上层使用RTP</strong>。所有的音视频的接收与发送，都是通过传输模块实现的。此外在传输层实现了<strong>网络链路的检测</strong>，进行网络带宽的估计，从而对（音视频、非音视频）数据的传输进行控制。</p> <div class="custom-block tip"><p class="custom-block-title">扩展</p> <ul><li>由于浏览器需要安全传输，所以使用了 <code>SRTP</code> 协议，为了进行控制，使用了 <code>RTCP</code>;</li> <li>为了处理多个流复用同一个通道，实现了 <code>Multiplexing</code>。</li> <li>最下面实现了<strong>P2P相关的协议</strong>，比如 <code>STUN</code> + <code>TRUN</code> + <code>ICE</code>。</li> <li>虽然UDP很适合实时通讯，但是也有需要使用TCP的场景：连通性TCP要优于UDP，假如国内外通信，可能某些区域不允许通过UDP进行实时传输。为了保证连通率，优先选择UDP，如果UDP无法通信，则选择TCP，以此来保证连通率。当然，也存在部分情况，TCP依旧不通，比如通过企业内部网访问，网关拒绝访问外网，这时可以使用Https。这时不太保证实时性了。</li></ul></div> <h2 id="webrtc-api"><a href="#webrtc-api" class="header-anchor">#</a> WebRTC API</h2> <p>WebRTC 标准概括介绍了两种不同的技术：<strong>媒体捕获设备和点对点连接</strong>。</p> <p>媒体捕获设备包括<strong>摄像机和麦克风</strong>，还包括<strong>屏幕捕获设备</strong>。对于摄像头和麦克风，我们使用 <code>navigator.mediaDevices.getUserMedia()</code> 来捕获 MediaStreams。对于屏幕录制，我们改为使用 <code>navigator.mediaDevices.getDisplayMedia()</code>。</p> <p>点对点连接由 <code>RTCPeerConnection</code> 接口处理。这是在 WebRTC 中<strong>两个对等方之间建立和控制连接的中心点</strong>。</p> <h2 id="媒体设备使用入门"><a href="#媒体设备使用入门" class="header-anchor">#</a> 媒体设备使用入门</h2> <p>针对 Web 开发时，WebRTC 标准提供了用于访问连接到计算机或智能手机的相机和麦克风的 API。这些设备通常称为<strong>媒体设备</strong>，可以通过实现 <code>MediaDevices</code> 接口的 <code>navigator.mediaDevices</code> 对象使用 JavaScript 进行访问。通过此对象，我们可以<strong>枚举所有已连接的设备</strong>，<strong>监听设备的变化</strong>（设备连接或断开连接时）以及<strong>打开设备以检索媒体流</strong>（见下文）。</p> <p>其最常见的方式是通过 <code>getUserMedia()</code> 函数，该函数会返回一个解析为匹配媒体设备的 <code>MediaStream</code> 的 promise。此函数采用单个 <code>MediaStreamConstraints</code> 对象，用于指定我们的要求。例如，要简单地打开默认麦克风和摄像头，请执行以下操作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">openMediaDevices</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">constraints</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token function">openMediaDevices</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">'video'</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token string-property property">'audio'</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Got MediaStream:'</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error accessing media devices.'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>调用 <code>getUserMedia()</code> 将<strong>触发权限请求</strong>。如果用户接受该权限，系统会使用包含一个视频和一个音轨的 MediaStream 解析该 promise。如果权限遭拒，系统会抛出 <code>PermissionDeniedError</code>。如果没有连接任何匹配的设备，则会抛出 <code>NotFoundError</code>。</p> <h3 id="查询媒体设备"><a href="#查询媒体设备" class="header-anchor">#</a> 查询媒体设备</h3> <p>在更复杂的应用中，我们很可能需要检查所有连接的摄像头和麦克风，并向用户提供相应的反馈。这可以通过调用 <code>enumerateDevices()</code> 函数来实现。这将返回一个 promise，它可以解析为描述每个已知媒体设备的 <code>MediaDevicesInfo</code> 数组。我们可以用它来呈现界面，让用户选择他们喜欢的那个。每个 <code>MediaDevicesInfo</code> 都包含一个名为 <code>kind</code> 的属性，其值为 <code>audioinput</code>、<code>audiooutput</code> 或 <code>videoinput</code>，指示它是哪种类型的媒体设备。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getConnectedDevices</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> devices <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> devices<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">device</span> <span class="token operator">=&gt;</span> device<span class="token punctuation">.</span>kind <span class="token operator">===</span> type<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> videoCameras <span class="token operator">=</span> <span class="token function">getConnectedDevices</span><span class="token punctuation">(</span><span class="token string">'videoinput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cameras found:'</span><span class="token punctuation">,</span> videoCameras<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="监听设备更改"><a href="#监听设备更改" class="header-anchor">#</a> 监听设备更改</h3> <p>大多数计算机都支持在运行时插入各种设备。它可能是通过 USB 连接的摄像头、蓝牙耳机或一组外部扬声器。为了正确支持这一点，Web 应用应监听媒体设备的变化。这可以通过为 <code>devicechange</code> 事件的 <code>navigator.mediaDevices</code> 添加监听器来实现。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Updates the select element with the provided set of cameras</span>
<span class="token keyword">function</span> <span class="token function">updateCameraList</span><span class="token punctuation">(</span><span class="token parameter">cameras</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> listElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'select#availableCameras'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    listElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    cameras<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">camera</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> cameraOption <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'option'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cameraOption<span class="token punctuation">.</span>label <span class="token operator">=</span> camera<span class="token punctuation">.</span>label<span class="token punctuation">;</span>
        cameraOption<span class="token punctuation">.</span>value <span class="token operator">=</span> camera<span class="token punctuation">.</span>deviceId<span class="token punctuation">;</span>
        <span class="token keyword">return</span> cameraOption<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cameraOption</span> <span class="token operator">=&gt;</span> listElement<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cameraOption<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fetch an array of devices of a certain type</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getConnectedDevices</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> devices <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> devices<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">device</span> <span class="token operator">=&gt;</span> device<span class="token punctuation">.</span>kind <span class="token operator">===</span> type<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Get the initial set of cameras connected</span>
<span class="token keyword">const</span> videoCameras <span class="token operator">=</span> <span class="token function">getConnectedDevices</span><span class="token punctuation">(</span><span class="token string">'videoinput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">updateCameraList</span><span class="token punctuation">(</span>videoCameras<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listen for changes to media devices and update the list accordingly</span>
navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'devicechange'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newCameraList <span class="token operator">=</span> <span class="token function">getConnectedDevices</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateCameraList</span><span class="token punctuation">(</span>newCameraList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="媒体限制"><a href="#媒体限制" class="header-anchor">#</a> 媒体限制</h3> <p>如果约束对象必须实现 <code>MediaStreamConstraints</code> 接口并将其作为参数传递给 <code>getUserMedia()</code>，我们就可以打开符合特定要求的媒体设备。此要求可以非常宽泛（音频和/或视频），也可以非常具体（最低相机分辨率或确切设备 ID）。建议使用 <code>getUserMedia()</code> API 的应用先检查现有设备，然后使用 <code>deviceId</code> 限制条件指定与设备完全匹配的限制条件。如果可能，设备还会根据限制条件进行配置。我们可以对麦克风启用回声消除功能，也可以从摄像头设置视频的特定或最小宽度和高度。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getConnectedDevices</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> devices <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> devices<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">device</span> <span class="token operator">=&gt;</span> device<span class="token punctuation">.</span>kind <span class="token operator">===</span> type<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Open camera with at least minWidth and minHeight capabilities</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">openCamera</span><span class="token punctuation">(</span><span class="token parameter">cameraId<span class="token punctuation">,</span> minWidth<span class="token punctuation">,</span> minHeight</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'audio'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'echoCancellation'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">'video'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'deviceId'</span><span class="token operator">:</span> cameraId<span class="token punctuation">,</span>
            <span class="token string-property property">'width'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'min'</span><span class="token operator">:</span> minWidth<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">'height'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">'min'</span><span class="token operator">:</span> minHeight<span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> cameras <span class="token operator">=</span> <span class="token function">getConnectedDevices</span><span class="token punctuation">(</span><span class="token string">'videoinput'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>cameras <span class="token operator">&amp;&amp;</span> cameras<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Open first available video camera with a resolution of 1280x720 pixels</span>
    <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token function">openCamera</span><span class="token punctuation">(</span>cameras<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>deviceId<span class="token punctuation">,</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="本地播放"><a href="#本地播放" class="header-anchor">#</a> 本地播放</h3> <p>媒体设备打开后，如果有 MediaStream，我们可以将其分配给视频或音频元素，以在本地播放流。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">playVideoFromCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">'video'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string-property property">'audio'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> videoElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video#localVideo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        videoElement<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error opening video camera.'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>与 <code>getUserMedia()</code> 一起使用的典型视频元素所需的 HTML 通常具有 <code>autoplay</code> 和 <code>playsinline</code> 属性。<strong><code>autoplay</code> 属性将使分配给元素的新数据流自动播放。<code>playsinline</code> 属性允许视频在特定移动浏览器中内嵌播放，而不仅仅是全屏播放</strong>。此外，我们还建议对直播使用 controls=&quot;false&quot;，除非用户应能够暂停这些直播。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Local video playback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localVideo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoplay</span> <span class="token attr-name">playsinline</span> <span class="token attr-name">controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="媒体捕获和约束"><a href="#媒体捕获和约束" class="header-anchor">#</a> 媒体捕获和约束</h2> <p>WebRTC 的媒体部分介绍了如何使用能够捕捉视频和音频的硬件（例如相机和麦克风），以及媒体流的工作原理。此外，还介绍了显示媒体，这是应用可执行屏幕捕获的方式。</p> <h3 id="媒体设备"><a href="#媒体设备" class="header-anchor">#</a> 媒体设备</h3> <p>您可以通过 <code>navigator.mediaDevices</code> 对象访问和管理浏览器支持的所有摄像头和麦克风。应用可以检索已连接设备的最新列表并监听变化，因为许多相机和微型麦克风可通过 USB 连接，并且可以在应用生命周期内连接和断开连接。由于媒体设备的状态可能会随时发生变化，因此建议应用注册设备更改，以便正确处理更改。</p> <h3 id="约束条件"><a href="#约束条件" class="header-anchor">#</a> 约束条件</h3> <p>访问媒体设备时，建议您提供尽可能详细的限制条件。虽然可以通过简单的约束条件打开默认摄像头和麦克风，但其提供的媒体流可能明显优于应用的最佳流。</p> <p>具体的约束条件在 <code>MediaTrackConstraint</code> 对象中定义，一个针对音频，另一个针对视频。此对象中的特性类型为 <code>ConstraintLong</code>、<code>ConstraintBoolean</code>、<code>ConstraintDouble</code> 或 <code>ConstraintDOMString</code>。这些对象可以是特定值（例如数字、布尔值或字符串）、范围（具有最小值和最大值的 LongRange 或 DoubleRange）或具有 <code>ideal</code> 或 <code>exact</code> 定义的对象。对于特定值，浏览器将尝试选择尽可能接近的值。对于某个范围，将使用该范围内的最佳值。指定 <code>exact</code> 后，系统将仅返回与约束条件完全匹配的媒体流。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Camera with a resolution as close to 640x480 as possible</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;video&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token number">480</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Camera with a resolution in the range 640x480 to 1024x768</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;video&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">640</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">1024</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;min&quot;</span><span class="token operator">:</span> <span class="token number">480</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;max&quot;</span><span class="token operator">:</span> <span class="token number">768</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Camera with the exact resolution of 1024x768</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;video&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;width&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;exact&quot;</span><span class="token operator">:</span> <span class="token number">1024</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;exact&quot;</span><span class="token operator">:</span> <span class="token number">768</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>为了确定某个媒体流的特定轨道的实际配置，我们可以调用 <code>MediaStreamTrack.getSettings()</code>，它会返回当前应用的 <code>MediaTrackSettings</code>。</p> <p>此外，也可以通过对媒体轨道上调用 <code>applyConstraints()</code> 来更新已打开的媒体设备上的轨道约束条件。这样，应用无需重新关闭现有音频流，即可重新配置媒体设备。</p> <h3 id="显示媒体"><a href="#显示媒体" class="header-anchor">#</a> 显示媒体</h3> <p>想要能够截取和录制屏幕的应用必须使用 <code>Display Media API</code>。函数 <code>getDisplayMedia()</code>（属于 <code>navigator.mediaDevices</code> 的一部分）与<code>getUserMedia()</code> 类似，用于打开显示内容（或部分内容，如窗口）。返回的 <code>MediaStream</code> 与使用 <code>getUserMedia()</code> 时相同。</p> <p><code>getDisplayMedia()</code> 的约束条件与常规视频或音频输入资源的限制不同。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">video</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">cursor</span><span class="token operator">:</span> <span class="token string">'always'</span> <span class="token operator">|</span> <span class="token string">'motion'</span> <span class="token operator">|</span> <span class="token string">'never'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">displaySurface</span><span class="token operator">:</span> <span class="token string">'application'</span> <span class="token operator">|</span> <span class="token string">'browser'</span> <span class="token operator">|</span> <span class="token string">'monitor'</span> <span class="token operator">|</span> <span class="token string">'window'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上述代码片段展示了屏幕录制的特殊限制的工作原理。请注意，并非所有支持显示媒体支持的浏览器都支持这些属性。</p> <h3 id="数据流和轨道"><a href="#数据流和轨道" class="header-anchor">#</a> 数据流和轨道</h3> <p><code>MediaStream</code> 表示媒体内容流，由音频和视频轨道 (<code>MediaStreamTrack</code>) 组成。您可以通过调用 <code>MediaStream.getTracks()</code> 从 <code>MediaStream</code> 检索所有轨道，该方法会返回一组 <code>MediaStreamTrack</code> 对象。</p> <h4 id="媒体流跟踪"><a href="#媒体流跟踪" class="header-anchor">#</a> 媒体流跟踪</h4> <p><code>MediaStreamTrack</code> 具有的 <code>kind</code> 属性为 <code>audio</code> 或 <code>video</code>，用于表示其表示的媒体类型。您可以通过切换其 <code>enabled</code> 属性将各个轨道静音。轨道具有布尔属性 <code>remote</code>，它会指示它来自 <code>RTCPeerConnection</code> 而来自远程对等设备。</p> <h2 id="开始使用对等连接"><a href="#开始使用对等连接" class="header-anchor">#</a> 开始使用对等连接</h2> <p>点对点连接是 WebRTC 规范的一部分，该规范旨在对点一台计算机上的两台应用进行连接，以<strong>使用点对点协议进行通信</strong>。对等设备之间的通信可以是视频、音频或任意二进制数据（适用于支持 RTCDataChannel API 的客户端）。为了发现两个对等端如何连接，两个客户端都需要提供 ICE Server 配置。这是 STUN 或 TURN 服务器，其作用是<strong>向每个客户端提供 ICE 候选对象</strong>，然后这些客户端将被<strong>传输到远程对等方</strong>。<strong>这种转移 ICE 候选对象的方式通常称为信号</strong>。</p> <h3 id="信令"><a href="#信令" class="header-anchor">#</a> 信令</h3> <p>WebRTC 规范包含用于与 ICE（互联网连接建立）服务器通信的 API，但<strong>信令组件并不属于该组件</strong>。需要发出信号才能让两个对等网络共享它们之间的连接方式。这通常可以通过基于 HTTP 的常规 Web API（即 REST 服务或其他 RPC 机制）解决，在此过程中，网络应用可在发起对等连接之前中继必要的信息。</p> <p>以下代码段展示了如何使用虚构信号服务异步发送和接收消息。必要时，本指南的其余示例将使用该方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Set up an asynchronous communication channel that will be</span>
<span class="token comment">// used during the peer connection setup</span>
<span class="token keyword">const</span> signalingChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SignalingChannel</span><span class="token punctuation">(</span>remoteClientId<span class="token punctuation">)</span><span class="token punctuation">;</span>
signalingChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// New message from remote client received</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send an asynchronous message to the remote client</span>
signalingChannel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>信令可以通过许多不同的方式实现，<strong>WebRTC 规范不偏好任何特定的解决方案</strong>。</p> <h3 id="启动对等连接"><a href="#启动对等连接" class="header-anchor">#</a> 启动对等连接</h3> <p>每个对等连接都由一个 <code>RTCPeerConnection</code> 对象处理。此类的构造函数接受单个 <code>RTCConfiguration</code> 对象作为其参数。此对象<strong>定义对等连接的设置方式</strong>，应<strong>包含关于要使用的 ICE 服务器的信息</strong>。</p> <p>创建 <code>RTCPeerConnection</code> 后，我们需要创建 SDP offer 或 answer，具体取决于我们是发起通话的对等方还是接收方的对等方。SDP offer 或 answer 一经创建，就必须通过其他信道发送给远程对等方。<strong>将 SDP 对象传递给远程对等设备的过程称为信号</strong>，不在 WebRTC 规范的涵盖范围内。</p> <p>为了从调用方启动对等连接设置，我们创建一个 <code>RTCPeerConnection</code> 对象，然后调用 <code>createOffer()</code> 以创建 <code>RTCSessionDescription</code> 对象。此会话说明设置为使用 <code>setLocalDescription()</code> 的本地说明，然后通过我们的信令通道发送到接收端。我们还针对针对信令渠道设置了监听器，接收方收到所提供会话说明后得回答会被监听到。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">makeCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> configuration <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-property property">'iceServers'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string-property property">'urls'</span><span class="token operator">:</span> <span class="token string">'stun:stun.l.google.com:19302'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    signalingChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>answer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> remoteDesc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCSessionDescription</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> peerConnection<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span>remoteDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> offer <span class="token operator">=</span> <span class="token keyword">await</span> peerConnection<span class="token punctuation">.</span><span class="token function">createOffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> peerConnection<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>offer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    signalingChannel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">'offer'</span><span class="token operator">:</span> offer<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>在接收端，创建 <code>RTCPeerConnection</code> 实例，创建 offer 并通过信令通道发送到远程。在等待 remote answer 的消息监听中，我们使用 <code>setRemoteDescription()</code> 设置收到的 answer。在远端，我们调用 <code>createAnswer()</code> 为收到的 offer 创建答案。系统会使用 <code>setLocalDescription()</code> 将此答案设置为本地说明，然后通过我们的信令服务器将其发送至发起调用的一方。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
signalingChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>offer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        peerConnection<span class="token punctuation">.</span><span class="token function">setRemoteDescription</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RTCSessionDescription</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>offer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> answer <span class="token operator">=</span> <span class="token keyword">await</span> peerConnection<span class="token punctuation">.</span><span class="token function">createAnswer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> peerConnection<span class="token punctuation">.</span><span class="token function">setLocalDescription</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signalingChannel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">'answer'</span><span class="token operator">:</span> answer<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>两个对等方同时设置了本地和远程会话说明之后，他们就会了解远程对等方的功能。<strong>这并不意味着对等设备之间的连接已准备就绪</strong>。为此，我们<strong>需要在每个对等端收集 ICE 候选项</strong>，并通过<strong>信令通道传输给另一个对等方</strong>。</p> <h3 id="ice-candidate"><a href="#ice-candidate" class="header-anchor">#</a> ICE Candidate</h3> <p>两个对等方必须用 WebRTC 交换连接信息，然后才能使用 WebRTC 进行通信。由于网络条件可能因多种因素而发生变化，因此通常使用外部服务来发现连接到对等网络的潜在<strong>候选对象</strong>。此服务称为 <strong>ICE，使用的是 STUN 或 TURN 服务器</strong>。<strong>STUN 代表用于 NAT 的会话遍历实用程序</strong>，通常在大多数 WebRTC 应用中间接使用。</p> <p>TURN（Traversal using Relay NAT）是一种<strong>整合了 STUN 协议的更高级解决方案</strong>，大多数基于 WebRTC 的商业服务都使用 TURN 服务器在对等方之间建立连接。<strong>WebRTC API 直接支持 STUN 和 TURN</strong>，在更完整的术语“互联网连接建立”下收集。创建 WebRTC 连接时，我们通常会在 RTCPeerConnection 对象的配置中提供一个或多个 ICE 服务器。</p> <h4 id="trickle-ice"><a href="#trickle-ice" class="header-anchor">#</a> Trickle ICE</h4> <p>创建 <code>RTCPeerConnection</code> 对象后，底层框架会使用提供的 ICE 服务器收集连接建立的候选对象（ICE 候选对象）。<code>RTCPeerConnection</code> 上的事件 <code>icegatheringstatechange</code> 会指示 ICE 收集的状态为（new、gathering 或 complete）。</p> <p>虽然对等设备可以等待 ICE 收集完成，但通常要高效地使用“滚动冰”技术，并在<strong>发现每个 ICE 候选设备后将其传输到远程对等设备</strong>。这将大大缩短对等连接的设置时间，并允许视频通话以更低的延迟开始。</p> <p>要收集 ICE 候选对象，只需为 <code>icecandidate</code> 事件添加监听器即可。针对该监听器发出的 <code>RTCPeerConnectionIceEvent</code> 将包含 <code>candidate</code> 属性，该属性表示应发送到远程对等端的新候选成员（请参阅信号）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Listen for local ICE candidates on the local RTCPeerConnection</span>
peerConnection<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'icecandidate'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        signalingChannel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">'new-ice-candidate'</span><span class="token operator">:</span> event<span class="token punctuation">.</span>candidate<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listen for remote ICE candidates and add them to the local RTCPeerConnection</span>
signalingChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>iceCandidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> peerConnection<span class="token punctuation">.</span><span class="token function">addIceCandidate</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>iceCandidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error adding received ice candidate'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="已建立连接"><a href="#已建立连接" class="header-anchor">#</a> 已建立连接</h3> <p>收到 ICE 候选对象后，我们的对等连接状态最终会变为已连接状态。为了检测这一点，我们在 <code>RTCPeerConnection</code> 中添加一个监听器，用于监听 <code>connectionstatechange</code> 事件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Listen for connectionstatechange on the local RTCPeerConnection</span>
peerConnection<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'connectionstatechange'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>peerConnection<span class="token punctuation">.</span>connectionState <span class="token operator">===</span> <span class="token string">'connected'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Peers connected!</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="远程数据流"><a href="#远程数据流" class="header-anchor">#</a> 远程数据流</h2> <p><code>RTCPeerConnection</code> 连接到远程对等设备后，就可以在它们之间<strong>流式传输音频和视频</strong>。此时，我们会将从 <code>getUserMedia()</code> 收到的数据流连接到 <code>RTCPeerConnection</code>。媒体流包含至少一个媒体轨道，当我们想将媒体传输到远程对等设备时，它们会分别添加到 <code>RTCPeerConnection</code> 中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> localStream <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">vide</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">audio</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>iceConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
localStream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">track</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    peerConnection<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>track<span class="token punctuation">,</span> localStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>轨道可以在连接到远程对等方之前添加到 <code>RTCPeerConnection</code>，因此<strong>最好尽早执行此设置，而不是等待连接完成</strong>。</p> <h3 id="添加远程轨道"><a href="#添加远程轨道" class="header-anchor">#</a> 添加远程轨道</h3> <p>为了接收由另一个对等方添加的远程轨道，我们会在本地 <code>RTCPeerConnection</code> 上注册一个监听器，用于监听 <code>track</code> 事件。<code>RTCTrackEvent</code> 包含一个 <code>MediaStream</code> 对象数组，这些对象与对等项的相应本地数据流具有相同的 <code>MediaStream.id</code> 值。在我们的示例中，每个轨道仅与单个数据流相关联。</p> <p>请注意，尽管 MediaStream ID 在对等端的两端均匹配，但 MediaStreamTrack ID 通常并非如此。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> remoteVideo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#remoteVideo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

peerConnection<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'track'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>remoteStream<span class="token punctuation">]</span> <span class="token operator">=</span> event<span class="token punctuation">.</span>streams<span class="token punctuation">;</span>
    remoteVideo<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> remoteStream<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="数据通道"><a href="#数据通道" class="header-anchor">#</a> 数据通道</h2> <p>WebRTC 标准还涵盖用于通过 <code>RTCPeerConnection</code> 发送任意数据的 API。可通过对 <code>RTCPeerConnection</code> 对象调用 <code>createDataChannel()</code> 来完成此操作，该方法会返回 <code>RTCDataChannel</code> 对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dataChannel <span class="token operator">=</span> peerConnection<span class="token punctuation">.</span><span class="token function">createDataChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>远程对等端可以通过监听 <code>RTCPeerConnection</code> 对象的 <code>datachannel</code> 事件来接收数据通道。收到的事件是 <code>RTCDataChannelEvent</code> 类型，包含一个 <code>channel</code> 属性，该属性表示在对等方之间连接的 <code>RTCDataChannel</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
peerConnection<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'datachannel'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dataChannel <span class="token operator">=</span> event<span class="token punctuation">.</span>channel<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="打开和关闭事件"><a href="#打开和关闭事件" class="header-anchor">#</a> 打开和关闭事件</h3> <p>在使用数据通道发送数据之前，客户端需要等到数据通道打开后才能使用它。具体方法是监听 <code>open</code> 事件。同样，当任意一侧关闭频道时，也会发生 <code>close</code> 事件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> messageBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#messageBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sendButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sendButton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dataChannel <span class="token operator">=</span> peerConnection<span class="token punctuation">.</span><span class="token function">createDataChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enable textarea and button when opened</span>
dataChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    messageBox<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    messageBox<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sendButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Disable input when closed</span>
dataChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    messageBox<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    sendButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="信息"><a href="#信息" class="header-anchor">#</a> 信息</h3> <p>如需在 <code>RTCDataChannel</code> 上发送消息，请使用要发送的数据调用 <code>send()</code> 函数。此函数的 <code>data</code> 参数可以是字符串、Blob、ArrayBuffer 或 ArrayBufferView。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> messageBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#messageBox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sendButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sendButton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Send a simple text message when we click the button</span>
sendButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> messageBox<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
    dataChannel<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>远程对等端将通过监听 <code>message</code> 事件来接收 <code>RTCDataChannel</code> 上发送的消息。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> incomingMessages <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#incomingMessages'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dataChannel <span class="token operator">=</span> peerConnection<span class="token punctuation">.</span><span class="token function">createDataChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Append new messages to the box of incoming messages</span>
dataChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    incomingMessages<span class="token punctuation">.</span>textContent <span class="token operator">+=</span> message <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="turn-服务器"><a href="#turn-服务器" class="header-anchor">#</a> TURN 服务器</h2> <p>对于大多数 WebRTC 应用，服务器都需要<strong>在对等设备之间中继流量</strong>，因为在客户端之间通常<strong>无法实现直接套接字</strong>（除非这些应用在同一本地网络中）。解决此问题的常见方法是使用 TURN 服务器。术语表示使用<strong>中继 NAT 的遍历</strong>，是一种<strong>中继网络流量的协议</strong>。</p> <p>目前有几种针对 TURN 服务器的选择：<strong>在线托管应用（如开源 COTURN 项目）和作为云提供的服务</strong>。</p> <p>有了 TURN 服务器可在线使用后，您只需具备正确的 <code>RTCConfiguration</code> 以供客户端应用使用。以下代码段展示了 <code>RTCPeerConnection</code> 的示例配置，其中 TURN 服务器的主机名为 <code>my-turn-server.mycompany.com</code>，端口为 19403。配置对象还支持 <code>username</code> 和 <code>credentials</code> 属性，以确保对服务器访问的安全。连接到 TURN 服务器时需要这些证书。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> iceConfiguration <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">iceServers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">urls</span><span class="token operator">:</span> <span class="token string">'turn:my-turn-server.mycompany.com:19403'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'optional-username'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">'auth-token'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> peerConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RTCPeerConnection</span><span class="token punctuation">(</span>iceConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="测试-webrtc-应用"><a href="#测试-webrtc-应用" class="header-anchor">#</a> 测试 WebRTC 应用</h2> <p>为 WebRTC 应用编写自动化测试时，可以对浏览器启用一些有用的配置，以便更轻松地进行开发和测试。</p> <h3 id="chrome"><a href="#chrome" class="header-anchor">#</a> Chrome</h3> <p>在 Chrome 上运行自动化测试时，以下参数在启动时非常有用：</p> <ul><li><code>--allow-file-access-from-files</code> - 允许访问 file:// 网址的 API</li> <li><code>--disable-translate</code> - 停用翻译弹出窗口</li> <li><code>--use-fake-ui-for-media-stream</code> - 提供虚假媒体流。在 CI 服务器上运行时非常有用。</li> <li><code>--use-file-for-fake-audio-capture=&lt;filename&gt;</code> - 提供用于捕获音频的文件。</li> <li><code>--use-file-for-fake-video-capture=&lt;filename&gt;</code> - 提供在捕获视频时使用的文件。</li> <li><code>--headless</code> - 在无头模式下运行。在 CI 服务器上运行时非常有用。</li> <li><code>--mute-audio</code> - 将音频输出静音。</li></ul> <h3 id="firefox"><a href="#firefox" class="header-anchor">#</a> Firefox</h3> <p>在 Firefox 上运行自动化测试时，您需要提供一组偏好设置键，这些键将用于已启动的实例。以下是用于 WebRTC 自动化测试示例的配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string-property property">&quot;prefs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;browser.cache.disk.enable&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.cache.disk.capacity&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.cache.disk.smart_size.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.cache.disk.smart_size.first_run&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.sessionstore.resume_from_crash&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.startup.page&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;media.navigator.streams.fake&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;media.navigator.permission.disabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;device.storage.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;media.gstreamer.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.startup.homepage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;about:blank&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.startup.firstrunSkipsHomepage&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;extensions.update.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;app.update.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;network.http.use-cache&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;browser.shell.checkDefaultBrowser&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="webrtc运行机制"><a href="#webrtc运行机制" class="header-anchor">#</a> WebRTC运行机制</h2> <h3 id="轨与流"><a href="#轨与流" class="header-anchor">#</a> 轨与流</h3> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.7gmr902yuvk0.webp" loading="lazy" class="lazy"></p> <ul><li>轨：比如一路音频，就是一路轨;一路视频，也是一路轨。两条轨之间是不相交的，单独存放！！两路音频也是两路轨，也是不相交的。</li> <li>流：媒体流，内部包含了很多轨，两者属于层级关系。</li></ul> <h3 id="重要类"><a href="#重要类" class="header-anchor">#</a> 重要类</h3> <ul><li><code>MediaStream</code>：同前面的讲解。</li> <li><code>RTCPeerConnection</code>：是整个WebRTC中最重要的类（大而全），包含了很多的功能。对于应用层非常方便，在应用层只要创建了 PeerConnection，然后将流放入 PeerConnection 中即可，其他的逻辑全部由 peerConnection 内部实现</li> <li><code>RTCDataChannel</code>：对于非音视频的数据，都通过dataChannel进行传输。其中RTCDataChannel是通过RTCPeerConnection获取的。</li></ul> <h3 id="peerconnection调用过程"><a href="#peerconnection调用过程" class="header-anchor">#</a> PeerConnection调用过程</h3> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.1utosrgu3600.webp" loading="lazy" class="lazy"></p> <p>PeerConnection中包含两个线程，Worker线程和Signaling线程，可以创建 <code>PeerConnectionFactory</code> ，之后 <code>PeerConnectionFactory</code> 可以创建 <code>PeerConnection</code> 和 <code>LocalMediaStream</code> 和 <code>LocalVideo</code>/<code>AudioTrack</code>，通过 <code>AddTrack</code> 将我们创建的多个 <code>Track</code> 轨加入到 <code>MediaStream</code> 流中，通过 <code>AddStream</code> 可以将多个 <code>MediaStream</code> 流（与多方通信，每一方（每一个参与单位）都是对应一个Stream）加入同一个 <code>PeerConnection</code> 中（复用）。</p> <h3 id="调用时序图"><a href="#调用时序图" class="header-anchor">#</a> 调用时序图</h3> <p><img alt="image" data-src="https://cdn.jsdelivr.net/gh/jonsam-ng/image-hosting@master/20220628/image.3ncy3d2ltyk0.webp" loading="lazy" class="lazy"></p> <ol><li>首先应用层 Application（注意这里Application本身就是一个 <code>PeerConnectionObserver</code>），创建出一个 <code>PeerConnectionFactory</code>(通过<code>CreatePeerConnectionFactory</code>)；</li> <li><code>PeerConnectionFactory</code> 触发 <code>CreatePeerConnection</code>、<code>CreateLocalMediaStream</code>、<code>CreateLocalVideoTrack</code>、<code>CreateLocalAudioTrack</code> 创建了 <code>PeerConnection</code>、<code>MediaStream</code> 等等实例；</li> <li>然后通过 <code>AddTrack</code>，把各种轨（track）加到流（<code>LocalMediaStream</code>）中去，然后通过 <code>AddStream</code>，把流加到 <code>PeerConnection</code> 中；</li> <li>流加到 <code>PeerConnection</code> 之后，会通过 <code>CommitStreamChanges</code> 提交流的变化；当流发生变化的时候，会触发 <code>OnSignalingMessage</code> 事件，创造出一个 <code>offer</code>【SDP描述信息】；</li> <li>有了 <code>offer</code>【SDP描述信息】之后，就会通过应用层Application，通过信令，发送到远端【Send offer to the remote peer】；</li></ol> <div class="custom-block tip"><p class="custom-block-title">扩展</p> <p>【SDP描述信息】内容：有哪些音视频数据，音视频数据的格式分别是什么，传输地址是什么等。</p></div> <ol start="6"><li>远端收到数据后，则根据 <code>offerSDP</code>，回复一个 <code>answerSDP</code>【Get answer from the remote peer】，交给本地信令；</li> <li>信令收到远端的 <code>answerSDP</code> 之后，会把信息传给本地 <code>PeerConnection</code>【ProcessSignalingMessage】，本地 <code>PeerConnection</code> 就会拿到对方的媒体流信息、传输端口、传输地址；至此，远端和本地就打通连接，可以相互传媒体数据；</li> <li>远端数据来的时候，<code>PeerConnection</code> 还会将远端的流添加到Application中去；【OnAddStream（注意区分AddStream）】</li></ol> <h2 id="声明"><a href="#声明" class="header-anchor">#</a> 声明</h2> <ul><li>本文部分内容来源于<a href="https://www.cnblogs.com/ssyfj/p/14778839.html#%E4%B8%80%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">WebRTC学习（一）WebRTC了解 - 山上有风景<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，特此感谢。</li></ul> <h2 id="实例"><a href="#实例" class="header-anchor">#</a> 实例</h2> <ul><li><a href="https://webrtc.github.io/samples/" target="_blank" rel="noopener noreferrer">WebRTC samples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://webrtc.org/getting-started/overview" target="_blank" rel="noopener noreferrer">WebRTC 使用入门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/webrtc/samples" target="_blank" rel="noopener noreferrer">webrtc/samples: WebRTC Web demos and samples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/ssyfj/p/14778839.html#%E4%B8%80%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">WebRTC学习（一）WebRTC了解 - 山上有风景<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/jonsam-ng/fancy-webrtc/edit/master/docs/20.基础/20.概要/10.intro.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/07/11, 09:43:09</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/basic/intro/index/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">本章导读</div></a> <a href="/basic/intro/stats/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">读懂 WebRTC's Statistics API</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/basic/intro/index/" class="prev">本章导读</a></span> <span class="next"><a href="/basic/intro/stats/">读懂 WebRTC's Statistics API</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/basic/p2p/stun/"><div>
            STUN 详解
            <!----></div></a> <span class="date">07-21</span></dt></dl><dl><dd>02</dd> <dt><a href="/source/api/index/"><div>
            本章导读
            <!----></div></a> <span class="date">07-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/source/category/"><div>
            目录结构
            <!----></div></a> <span class="date">07-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:jonsam.ng@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/jonsam-ng" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.jonsam.site" title="博客" target="_blank" class="iconfont icon-mao"></a><a href="https://docs.jonsam.site" title="文档" target="_blank" class="iconfont icon-shuben"></a><a href="https://source.jonsam.site" title="源码" target="_blank" class="iconfont icon-code"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>Fancy WebRTC | Template by <a href="https://jonsam-ng.github.io/fancy-note-starter/">Fancy Note Starter</a> | Made by <a href=https://www.jonsam.site target="_blank">jonsam</a> with ❤</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div><!----><!----><!----><div></div><div></div></div></div>
    <script src="/assets/js/app.2b835d01.js" defer></script><script src="/assets/js/11.8f8d8c94.js" defer></script><script src="/assets/js/36.f2070bed.js" defer></script><script src="/assets/js/16.2ef6dce7.js" defer></script><script src="/assets/js/21.8f4f04c1.js" defer></script><script src="/assets/js/19.7a274e56.js" defer></script><script src="/assets/js/20.cc7484e4.js" defer></script><script src="/assets/js/15.daa60dcc.js" defer></script><script src="/assets/js/13.f9165900.js" defer></script>
  </body>
</html>
